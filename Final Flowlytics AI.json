{
  "name": "Final Flowlytics AI",
  "nodes": [
    {
      "parameters": {
        "jsCode": "// NODE 4: CALCULATE METRICS (DEBUG VERSION)\nconsole.log(\"=== NODE 4 START ===\");\nconsole.log(\"Input items length:\", items.length);\n\n// Check ALL input items structure\nitems.forEach((item, index) => {\n  console.log(`\\n--- Item ${index} Keys ---`);\n  console.log(\"Item keys:\", Object.keys(item.json));\n  \n  // Look for cleaned_orders in ANY input item\n  if (item.json.cleaned_orders) {\n    console.log(`FOUND cleaned_orders in item ${index}:`, item.json.cleaned_orders.length);\n  }\n  if (item.json.data) {\n    console.log(`FOUND data in item ${index}:`, item.json.data.length);\n  }\n  if (item.json.orders) {\n    console.log(`FOUND orders in item ${index}:`, item.json.orders.length);\n  }\n});\n\n// FIND THE RIGHT DATA SOURCE\nlet orders = [];\nlet dataSource = \"unknown\";\n\n// Priority 1: Look for cleaned_orders\nfor (let item of items) {\n  if (item.json.cleaned_orders && Array.isArray(item.json.cleaned_orders)) {\n    orders = item.json.cleaned_orders;\n    dataSource = \"cleaned_orders\";\n    console.log(\"Using cleaned_orders\");\n    break;\n  }\n}\n\n// Priority 2: Look for data array (your new test data)\nif (orders.length === 0) {\n  for (let item of items) {\n    if (item.json.data && Array.isArray(item.json.data)) {\n      orders = item.json.data;\n      dataSource = \"data\";\n      console.log(\"Using data array\");\n      break;\n    }\n  }\n}\n\n// Priority 3: Look for orders\nif (orders.length === 0) {\n  for (let item of items) {\n    if (item.json.orders && Array.isArray(item.json.orders)) {\n      orders = item.json.orders;\n      dataSource = \"orders\";\n      console.log(\"Using raw orders\");\n      break;\n    }\n  }\n}\n\n// Priority 4: If still empty, check if items[0] itself is array\nif (orders.length === 0 && Array.isArray(items[0].json)) {\n  orders = items[0].json;\n  dataSource = \"direct_array\";\n  console.log(\"Using direct array\");\n}\n\nconsole.log(\"\\n=== FINAL DATA SOURCE ===\");\nconsole.log(\"DataSource:\", dataSource);\nconsole.log(\"Orders count:\", orders.length);\nconsole.log(\"First order sample:\", orders[0] || \"No orders\");\n\n// If STILL no data, create from your test data\nif (orders.length === 0) {\n  console.log(\"Creating test data...\");\n  orders = [\n    {\n      order_id: \"FINAL1\",\n      customer_id: \"SAME_CUST\", \n      revenue: 100000,\n      profit: 20000,\n      status: \"Delivered\",\n      city: \"Test\"\n    },\n    {\n      order_id: \"FINAL2\",\n      customer_id: \"SAME_CUST\",\n      revenue: 200000, \n      profit: 40000,\n      status: \"Delivered\",\n      city: \"Test\"\n    },\n    {\n      order_id: \"FINAL3\",\n      customer_id: \"SAME_CUST\",\n      revenue: 300000,\n      profit: 60000,\n      status: \"Cancelled\",\n      city: \"Test\"\n    },\n    {\n      order_id: \"FINAL4\",\n      customer_id: \"DIFF_CUST\",\n      revenue: 400000,\n      profit: 80000,\n      status: \"Delivered\", \n      city: \"Test2\"\n    }\n  ];\n  dataSource = \"hardcoded_test\";\n}\n\nconsole.log(\"\\n=== CALCULATING METRICS ===\");\n\n// CALCULATE METRICS FROM ORDERS\nconst deliveredOrders = orders.filter(o => o.status === \"Delivered\");\nconst cancelledOrders = orders.filter(o => o.status === \"Cancelled\");\n\nconst totalRevenue = deliveredOrders.reduce((sum, o) => sum + (o.revenue || o.total_amount || 0), 0);\nconst totalProfit = deliveredOrders.reduce((sum, o) => sum + (o.profit || 0), 0);\nconst totalOrders = deliveredOrders.length;\nconst cancelledCount = cancelledOrders.length;\n\nconst aov = totalOrders > 0 ? totalRevenue / totalOrders : 0;\nconst profitMargin = totalRevenue > 0 ? (totalProfit / totalRevenue) * 100 : 0;\n\n// Unique customers\nconst uniqueCustomers = [...new Set(deliveredOrders.map(o => o.customer_id || o.customer_email))].length;\n\n// City analysis\nconst cityStats = {};\ndeliveredOrders.forEach(order => {\n  const city = order.city || \"Unknown\";\n  cityStats[city] = (cityStats[city] || 0) + 1;\n});\nconst topCity = Object.entries(cityStats).sort((a, b) => b[1] - a[1])[0] || [\"Unknown\", 0];\n\n// Customer analysis\nconst customerOrders = {};\ndeliveredOrders.forEach(order => {\n  const cust = order.customer_id || order.customer_email || \"unknown\";\n  customerOrders[cust] = (customerOrders[cust] || 0) + 1;\n});\nconst topCustomer = Object.entries(customerOrders).sort((a, b) => b[1] - a[1])[0] || [\"None\", 0];\n\n// Risk analysis (simple)\nconst riskyOrders = deliveredOrders.filter(order => {\n  // Mark high value orders without customer history as risky\n  if ((order.revenue || order.total_amount) > 50000) return true;\n  if (order.status === \"Cancelled\") return true;\n  return false;\n});\n\n// COMPILE METRICS\nconst metrics = {\n  // Core Metrics\n  total_revenue: Math.round(totalRevenue),\n  total_profit: Math.round(totalProfit),\n  total_orders: totalOrders,\n  cancelled_orders: cancelledCount,\n  order_success_rate: totalOrders > 0 ? ((totalOrders / (totalOrders + cancelledCount)) * 100).toFixed(1) : \"0.0\",\n  \n  // Calculated Metrics\n  average_order_value: Math.round(aov),\n  profit_margin: profitMargin.toFixed(2),\n  \n  // Customer Metrics\n  unique_customers: uniqueCustomers,\n  repeat_customer_rate: uniqueCustomers > 0 ? ((topCustomer[1] / totalOrders) * 100).toFixed(1) : \"0.0\",\n  top_customer: {\n    id: topCustomer[0],\n    orders: topCustomer[1]\n  },\n  \n  // Geographic Metrics\n  top_city: {\n    name: topCity[0],\n    orders: topCity[1],\n    percentage: totalOrders > 0 ? ((topCity[1] / totalOrders) * 100).toFixed(1) : \"0.0\"\n  },\n  \n  // Risk Metrics\n  risky_orders_count: riskyOrders.length,\n  risk_percentage: totalOrders > 0 ? ((riskyOrders.length / totalOrders) * 100).toFixed(1) : \"0.0\",\n  \n  // Debug Info\n  _debug: {\n    data_source: dataSource,\n    orders_processed: orders.length,\n    delivered_orders: deliveredOrders.length,\n    calculation_time: new Date().toISOString()\n  }\n};\n\nconsole.log(\"\\n=== CALCULATED METRICS ===\");\nconsole.log(\"Revenue:\", metrics.total_revenue);\nconsole.log(\"Profit:\", metrics.total_profit);\nconsole.log(\"Orders:\", metrics.total_orders);\nconsole.log(\"AOV:\", metrics.average_order_value);\nconsole.log(\"Risky Orders:\", metrics.risky_orders_count);\n\n// Prepare output\nconst outputData = {\n  // Keep ALL input data\n  ...(items[0]?.json || {}),\n  ...(items[1]?.json || {}),\n  \n  // Add our calculated metrics\n  metrics: metrics,\n  \n  // Add the orders we used for calculation\n  calculation_source: dataSource,\n  processed_orders: orders,\n  \n  // Add summary\n  summary: `âœ… Processed ${orders.length} orders. Revenue: â‚¹${metrics.total_revenue}. Profit: â‚¹${metrics.total_profit}.`,\n  \n  // Timestamp\n  calculated_at: new Date().toISOString()\n};\n\nconsole.log(\"\\n=== OUTPUT PREPARED ===\");\nconsole.log(\"Output keys:\", Object.keys(outputData));\n\nreturn [{\n  json: outputData\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2416,
        48
      ],
      "id": "4859830f-d853-4e0c-83ad-7ffb1988e605",
      "name": "Calculate matrix"
    },
    {
      "parameters": {
        "jsCode": "// NODE 5: AI Insights Generator (Rule-Based - NO API Needed)\nconst metrics = items[0].json.metrics;\nconst orders = items[0].json.cleaned_orders || [];\n\nconsole.log(\"Generating AI insights from metrics...\");\n\n// FUNCTION: Generate business insights based on rules\nfunction generateInsights(metrics, orders) {\n  const insights = [];\n  \n  // 1. COD ANALYSIS\n  const codPercentage = parseFloat(metrics.cod_percentage);\n  if (codPercentage > 60) {\n    insights.push({\n      emoji: \"âš ï¸\",\n      insight: `High COD dependency (${codPercentage}%)`,\n      action: `Offer 7% discount for prepaid orders to reduce fraud risk`\n    });\n  } else if (codPercentage > 30) {\n    insights.push({\n      emoji: \"ðŸ“Š\",\n      insight: `Moderate COD usage (${codPercentage}%)`,\n      action: `Add OTP verification for COD orders above â‚¹3,000`\n    });\n  }\n  \n  // 2. AOV ANALYSIS\n  const aov = metrics.average_order_value;\n  if (aov > 6000) {\n    insights.push({\n      emoji: \"ðŸ’°\",\n      insight: `Excellent AOV (â‚¹${aov})`,\n      action: `Create premium bundles to cross â‚¹7,500 AOV`\n    });\n  } else if (aov > 4000) {\n    insights.push({\n      emoji: \"ðŸ“ˆ\",\n      insight: `Good AOV (â‚¹${aov})`,\n      action: `Add \"Frequently bought together\" suggestions`\n    });\n  } else {\n    insights.push({\n      emoji: \"ðŸ“‰\",\n      insight: `AOV â‚¹${aov} needs improvement`,\n      action: `Offer free shipping on orders above â‚¹${Math.round(aov * 1.5)}`\n    });\n  }\n  \n  // 3. REFUND ANALYSIS\n  const refundRate = parseFloat(metrics.refund_rate);\n  if (refundRate > 10) {\n    insights.push({\n      emoji: \"ðŸ”´\",\n      insight: `High refund rate (${refundRate}%)`,\n      action: `Review product quality and add detailed size charts`\n    });\n  } else if (refundRate > 5) {\n    insights.push({\n      emoji: \"ðŸŸ \",\n      insight: `Moderate refunds (${refundRate}%)`,\n      action: `Improve product descriptions and images`\n    });\n  } else {\n    insights.push({\n      emoji: \"âœ…\",\n      insight: `Healthy refund rate (${refundRate}%)`,\n      action: `Maintain current quality standards`\n    });\n  }\n  \n  // 4. GEOGRAPHIC ANALYSIS\n  const topCity = metrics.top_city.name;\n  const cityPercentage = parseFloat(metrics.top_city.percentage);\n  \n  if (cityPercentage > 40) {\n    insights.push({\n      emoji: \"ðŸ“\",\n      insight: `${topCity} dominates (${cityPercentage}% of sales)`,\n      action: `Run targeted ads in ${getUnderperformingCity(orders, topCity)} to expand`\n    });\n  }\n  \n  // 5. RISK ANALYSIS\n  if (metrics.risky_orders_count > 0) {\n    const riskPct = parseFloat(metrics.risk_percentage);\n    if (riskPct > 20) {\n      insights.push({\n        emoji: \"ðŸš¨\",\n        insight: `High risk orders (${riskPct}%)`,\n        action: `Implement strict verification for COD in ${topCity}`\n      });\n    }\n  }\n  \n  // 6. TIME ANALYSIS (if we have time data)\n  const peakTime = analyzePeakTime(orders);\n  if (peakTime) {\n    insights.push({\n      emoji: \"â°\",\n      insight: `Peak sales at ${peakTime}`,\n      action: `Run flash sales or promotions during this time`\n    });\n  }\n  \n  return insights;\n}\n\n// Helper: Find underperforming city\nfunction getUnderperformingCity(orders, excludeCity) {\n  const cities = [\"Mumbai\", \"Delhi\", \"Bangalore\", \"Chennai\", \"Hyderabad\", \"Pune\"];\n  const cityCounts = {};\n  \n  orders.forEach(order => {\n    const city = order.city;\n    cityCounts[city] = (cityCounts[city] || 0) + 1;\n  });\n  \n  // Find city with least orders (excluding top city)\n  const availableCities = cities.filter(c => c !== excludeCity);\n  return availableCities[0] || \"Bangalore\";\n}\n\n// Helper: Analyze peak sales time\nfunction analyzePeakTime(orders) {\n  if (orders.length === 0) return null;\n  \n  const timeSlots = {\n    \"Morning (9AM-12PM)\": 0,\n    \"Afternoon (12PM-4PM)\": 0,\n    \"Evening (4PM-8PM)\": 0,\n    \"Night (8PM-12AM)\": 0\n  };\n  \n  orders.forEach(order => {\n    if (order.time) {\n      const hour = parseInt(order.time.split(':')[0]);\n      if (hour >= 9 && hour < 12) timeSlots[\"Morning (9AM-12PM)\"]++;\n      else if (hour >= 12 && hour < 16) timeSlots[\"Afternoon (12PM-4PM)\"]++;\n      else if (hour >= 16 && hour < 20) timeSlots[\"Evening (4PM-8PM)\"]++;\n      else if (hour >= 20 || hour < 4) timeSlots[\"Night (8PM-12AM)\"]++;\n    }\n  });\n  \n  const peakSlot = Object.entries(timeSlots).sort((a, b) => b[1] - a[1])[0];\n  return peakSlot[1] > 0 ? peakSlot[0] : null;\n}\n\n// Generate insights\nconst allInsights = generateInsights(metrics, orders);\n\n// Format for WhatsApp/Telegram\nconst formattedInsights = allInsights.slice(0, 3).map((ins, idx) => \n  `${idx + 1}. ${ins.emoji} ${ins.insight} - ${ins.action}`\n).join('\\n');\n\nconsole.log(\"Generated insights:\", formattedInsights);\n\n// Return data with insights\nreturn [{\n  json: {\n    ...items[0].json,\n    ai_insights: formattedInsights,\n    all_insights: allInsights,\n    insights_type: \"rule_based\",\n    generated_at: new Date().toISOString()\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2192,
        48
      ],
      "id": "47b7f71a-8540-4575-bb45-a8b8b2c668de",
      "name": "Function node"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -2656,
        48
      ],
      "id": "25f72167-8475-4f52-90d3-53accb47ce09",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "html": "{{ $json.html }}"
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        -1584,
        -96
      ],
      "id": "79c0a964-e914-4da5-9d98-46c068c1789b",
      "name": "HTML2"
    },
    {
      "parameters": {
        "html": "{{ $json.html }}"
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        -1632,
        160
      ],
      "id": "4ab2c6a3-508d-44d4-b413-a6f5e8bc3d67",
      "name": "HTML"
    },
    {
      "parameters": {
        "jsCode": "// ============= FLOWLYTICS AI ENTERPRISE DASHBOARD =============\nconsole.log(\"=== FLOWLYTICS AI BUSINESS INTELLIGENCE DASHBOARD ===\");\nconsole.log(\"Execution Time:\", new Date().toISOString());\n\n// ============= CONFIGURATION =============\nconst CONFIG = {\n  DASHBOARD_NAME: \"Flowlytics AI\",\n  FOUNDER_NAME: \"Atha\",\n  FOUNDER_MESSAGE: \"Intelligent Analytics for Smarter Decisions\",\n  TIMEZONE: 'Asia/Kolkata',\n  \n  // Thresholds for alerts\n  THRESHOLDS: {\n    LOW_REVENUE_PRODUCT: 50000,\n    HIGH_RISK_ORDER_VALUE: 50000,\n    MIN_LOYAL_ORDERS: 3,\n    MIN_LOYAL_REVENUE: 100000,\n    CANCELLATION_RATE_ALERT: 10,\n    RETURN_RATE_ALERT: 5,\n    COD_RISK_THRESHOLD: 30\n  }\n};\n\n// ============= HELPER FUNCTIONS =============\nfunction formatCurrency(value) {\n  return 'â‚¹' + parseInt(value).toLocaleString('en-IN');\n}\n\nfunction formatPercent(value) {\n  return parseFloat(value).toFixed(1) + '%';\n}\n\nfunction formatDate(dateString) {\n  if (!dateString) return 'N/A';\n  try {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-IN', {\n      timeZone: CONFIG.TIMEZONE,\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  } catch (e) {\n    return dateString;\n  }\n}\n\n// ============= ADVANCED ANALYTICS FUNCTIONS =============\nfunction analyzeCustomerLoyalty(orders) {\n  const deliveredOrders = orders.filter(o => o.status === 'Delivered');\n  const customers = {};\n  \n  deliveredOrders.forEach(order => {\n    const custId = order.customer_id || 'anonymous';\n    if (!customers[custId]) {\n      customers[custId] = {\n        id: custId,\n        orders: 0,\n        total_revenue: 0,\n        total_profit: 0,\n        cities: new Set(),\n        products: new Set(),\n        first_order: order.order_date || new Date().toISOString(),\n        last_order: order.order_date || new Date().toISOString(),\n        payment_methods: new Set()\n      };\n    }\n    \n    customers[custId].orders++;\n    customers[custId].total_revenue += parseFloat(order.revenue) || 0;\n    customers[custId].total_profit += parseFloat(order.profit) || 0;\n    if (order.city) customers[custId].cities.add(order.city);\n    if (order.product_name) customers[custId].products.add(order.product_name);\n    if (order.payment_method) customers[custId].payment_methods.add(order.payment_method);\n    customers[custId].last_order = order.order_date || customers[custId].last_order;\n  });\n  \n  const customerArray = Object.values(customers);\n  \n  customerArray.forEach(customer => {\n    const orderScore = Math.min(customer.orders * 20, 40);\n    const revenueScore = Math.min(customer.total_revenue / 50000, 40);\n    const recencyScore = calculateRecencyScore(customer.last_order);\n    \n    customer.loyalty_score = Math.min(orderScore + revenueScore + recencyScore, 100);\n    customer.loyalty_tier = getLoyaltyTier(customer.loyalty_score);\n    \n    const codOrders = customer.payment_methods.has('COD') ? 1 : 0;\n    const highValueOrders = customer.total_revenue / customer.orders > 50000 ? 1 : 0;\n    const singleCity = customer.cities.size === 1 ? 1 : 0;\n    \n    customer.risk_score = (codOrders * 40) + (highValueOrders * 30) + (singleCity * 30);\n    customer.risk_level = getRiskLevel(customer.risk_score);\n    \n    customer.avg_order_value = customer.total_revenue / customer.orders;\n    customer.profit_margin = customer.total_revenue > 0 ? \n      (customer.total_profit / customer.total_revenue * 100) : 0;\n  });\n  \n  const loyalCustomers = customerArray\n    .filter(c => c.loyalty_tier === 'Loyal')\n    .sort((a, b) => b.total_revenue - a.total_revenue);\n    \n  const riskyCustomers = customerArray\n    .filter(c => c.risk_level === 'High')\n    .sort((a, b) => b.risk_score - a.risk_score);\n  \n  return {\n    all_customers: customerArray,\n    loyal_customers: loyalCustomers,\n    risky_customers: riskyCustomers,\n    total_customers: customerArray.length,\n    loyal_count: loyalCustomers.length,\n    risky_count: riskyCustomers.length,\n    avg_loyalty_score: customerArray.reduce((sum, c) => sum + c.loyalty_score, 0) / customerArray.length\n  };\n}\n\nfunction calculateRecencyScore(lastOrderDate) {\n  if (!lastOrderDate) return 0;\n  const lastOrder = new Date(lastOrderDate);\n  const now = new Date();\n  const daysSince = Math.floor((now - lastOrder) / (1000 * 60 * 60 * 24));\n  \n  if (daysSince <= 7) return 20;\n  if (daysSince <= 30) return 15;\n  if (daysSince <= 90) return 10;\n  return 5;\n}\n\nfunction getLoyaltyTier(score) {\n  if (score >= 70) return 'Loyal';\n  if (score >= 40) return 'Regular';\n  return 'New';\n}\n\nfunction getRiskLevel(score) {\n  if (score >= 70) return 'High';\n  if (score >= 40) return 'Medium';\n  return 'Low';\n}\n\nfunction analyzeProductPerformance(orders) {\n  const deliveredOrders = orders.filter(o => o.status === 'Delivered');\n  const products = {};\n  const categories = {};\n  \n  deliveredOrders.forEach(order => {\n    const productId = order.product_id || order.product_name || 'Unknown';\n    const productName = order.product_name || 'Unknown Product';\n    const category = order.product_category || 'Uncategorized';  // FIXED: product_category not category\n    \n    if (!products[productId]) {\n      products[productId] = {\n        id: productId,\n        name: productName,\n        category: category,\n        orders: 0,\n        revenue: 0,\n        profit: 0,\n        quantity: 0,\n        cities: new Set(),\n        customers: new Set(),\n        payment_methods: new Set()\n      };\n    }\n    \n    const product = products[productId];\n    product.orders++;\n    product.revenue += parseFloat(order.revenue) || 0;\n    product.profit += parseFloat(order.profit) || 0;\n    product.quantity += parseFloat(order.quantity) || 1;\n    if (order.city) product.cities.add(order.city);\n    if (order.customer_id) product.customers.add(order.customer_id);\n    if (order.payment_method) product.payment_methods.add(order.payment_method);\n    \n    if (!categories[category]) {\n      categories[category] = {\n        name: category,\n        revenue: 0,\n        orders: 0,\n        products: new Set()\n      };\n    }\n    categories[category].revenue += parseFloat(order.revenue) || 0;\n    categories[category].orders++;\n    categories[category].products.add(productId);\n  });\n  \n  const productArray = Object.values(products).map(p => ({\n    ...p,\n    avg_price: p.revenue / p.quantity,\n    profit_margin: p.revenue > 0 ? (p.profit / p.revenue * 100) : 0,\n    revenue_per_order: p.revenue / p.orders,\n    city_coverage: p.cities.size,\n    customer_count: p.customers.size,\n    cities: Array.from(p.cities),\n    payment_methods: Array.from(p.payment_methods)\n  }));\n  \n  const categoryArray = Object.values(categories).map(c => ({\n    ...c,\n    avg_order_value: c.revenue / c.orders,\n    product_count: c.products.size,\n    revenue_share: c.revenue > 0 ? (c.revenue / productArray.reduce((sum, p) => sum + p.revenue, 0) * 100) : 0\n  }));\n  \n  const topByRevenue = [...productArray].sort((a, b) => b.revenue - a.revenue);\n  const topByProfit = [...productArray].sort((a, b) => b.profit - a.profit);\n  const topByOrders = [...productArray].sort((a, b) => b.orders - a.orders);\n  const lowPerforming = productArray.filter(p => p.revenue < CONFIG.THRESHOLDS.LOW_REVENUE_PRODUCT);\n  \n  const insights = generateProductInsights(productArray, categoryArray);\n  \n  return {\n    all_products: productArray,\n    top_by_revenue: topByRevenue,\n    top_by_profit: topByProfit,\n    top_by_orders: topByOrders,\n    low_performing: lowPerforming,\n    categories: categoryArray.sort((a, b) => b.revenue - a.revenue),\n    total_products: productArray.length,\n    total_categories: categoryArray.length,\n    insights: insights\n  };\n}\n\nfunction generateProductInsights(products, categories) {\n  const insights = [];\n  \n  const bestProduct = products.reduce((best, current) => \n    current.revenue > best.revenue ? current : best, products[0]);\n  \n  if (bestProduct) {\n    insights.push({\n      type: 'success',\n      title: 'Star Product Identified',\n      message: `${bestProduct.name} is your top performer with ${formatCurrency(bestProduct.revenue)} revenue`,\n      action: 'Increase stock and marketing for this product'\n    });\n  }\n  \n  const worstProduct = products.reduce((worst, current) => \n    current.revenue < worst.revenue ? current : worst, products[0]);\n  \n  if (worstProduct && worstProduct.revenue < CONFIG.THRESHOLDS.LOW_REVENUE_PRODUCT) {\n    insights.push({\n      type: 'warning',\n      title: 'Low Performing Product Alert',\n      message: `${worstProduct.name} generated only ${formatCurrency(worstProduct.revenue)}`,\n      action: `Review ${worstProduct.name} pricing and marketing strategy`\n    });\n  }\n  \n  const bestCategory = categories[0];\n  const worstCategory = categories[categories.length - 1];\n  \n  if (bestCategory && bestCategory.name !== 'Uncategorized') {\n    insights.push({\n      type: 'info',\n      title: 'Best Performing Category',\n      message: `${bestCategory.name} category leads with ${formatCurrency(bestCategory.revenue)} (${bestCategory.revenue_share.toFixed(1)}%)`,\n      action: `Expand ${bestCategory.name} product range`\n    });\n  }\n  \n  if (worstCategory && worstCategory.revenue < 100000) {\n    insights.push({\n      type: 'warning',\n      title: 'Category Needs Attention',\n      message: `${worstCategory.name} category underperforming at ${formatCurrency(worstCategory.revenue)}`,\n      action: `Review ${worstCategory.name} products. Consider promotions or reassortment.`\n    });\n  }\n  \n  const highMarginProducts = products.filter(p => p.profit_margin > 40);\n  if (highMarginProducts.length > 0) {\n    insights.push({\n      type: 'success',\n      title: 'High Margin Products',\n      message: `${highMarginProducts.length} products with >40% profit margin`,\n      action: 'Focus marketing on high-margin products for better profitability'\n    });\n  }\n  \n  return insights;\n}\n\nfunction analyzeLocationTrends(orders) {\n  const deliveredOrders = orders.filter(o => o.status === 'Delivered');\n  const cities = {};\n  const states = {};\n  const stateMap = {\n    'Mumbai': 'Maharashtra', 'Delhi': 'Delhi', 'Bangalore': 'Karnataka',\n    'Chennai': 'Tamil Nadu', 'Kolkata': 'West Bengal', 'Hyderabad': 'Telangana',\n    'Pune': 'Maharashtra', 'Ahmedabad': 'Gujarat', 'Jaipur': 'Rajasthan',\n    'Lucknow': 'Uttar Pradesh', 'Patna': 'Bihar', 'Chandigarh': 'Chandigarh',\n    'Coimbatore': 'Tamil Nadu', 'Vadodara': 'Gujarat', 'Guwahati': 'Assam',\n    'Visakhapatnam': 'Andhra Pradesh', 'Dehradun': 'Uttarakhand', 'Kochi': 'Kerala',\n    'Raipur': 'Chhattisgarh', 'Surat': 'Gujarat', 'Nagpur': 'Maharashtra',\n    'Indore': 'Madhya Pradesh', 'Bhopal': 'Madhya Pradesh', 'Bengaluru': 'Karnataka'\n  };\n  \n  deliveredOrders.forEach(order => {\n    const city = order.city || 'Unknown';\n    const state = stateMap[city] || 'Other';\n    \n    if (!cities[city]) {\n      cities[city] = {\n        name: city,\n        revenue: 0,\n        orders: 0,\n        profit: 0,\n        products: new Set(),\n        customers: new Set(),\n        cod_orders: 0,\n        return_orders: 0\n      };\n    }\n    \n    cities[city].revenue += parseFloat(order.revenue) || 0;\n    cities[city].orders++;\n    cities[city].profit += parseFloat(order.profit) || 0;\n    if (order.product_name) cities[city].products.add(order.product_name);\n    if (order.customer_id) cities[city].customers.add(order.customer_id);\n    if (order.payment_method === 'COD') cities[city].cod_orders++;\n    if (order.status === 'Returned') cities[city].return_orders++;\n    \n    if (!states[state]) {\n      states[state] = {\n        name: state,\n        revenue: 0,\n        orders: 0,\n        cities: new Set()\n      };\n    }\n    \n    states[state].revenue += parseFloat(order.revenue) || 0;\n    states[state].orders++;\n    states[state].cities.add(city);\n  });\n  \n  const cityArray = Object.values(cities).map(c => ({\n    ...c,\n    avg_order_value: c.revenue / c.orders,\n    profit_margin: c.revenue > 0 ? (c.profit / c.revenue * 100) : 0,\n    cod_percentage: (c.cod_orders / c.orders * 100),\n    return_percentage: (c.return_orders / c.orders * 100),\n    product_count: c.products.size,\n    customer_count: c.customers.size\n  }));\n  \n  const stateArray = Object.values(states).map(s => ({\n    ...s,\n    avg_order_value: s.revenue / s.orders,\n    city_count: s.cities.size\n  }));\n  \n  const topCities = cityArray.sort((a, b) => b.revenue - a.revenue);\n  const topStates = stateArray.sort((a, b) => b.revenue - a.revenue);\n  \n  const insights = [];\n  \n  if (topCities.length > 0) {\n    const bestCity = topCities[0];\n    const worstCity = topCities[topCities.length - 1];\n    \n    insights.push({\n      type: 'success',\n      title: 'Top Performing City',\n      message: `${bestCity.name} leads with ${formatCurrency(bestCity.revenue)}`,\n      action: `Expand operations in ${bestCity.name}`\n    });\n    \n    if (worstCity.revenue < 100000) {\n      insights.push({\n        type: 'warning',\n        title: 'City Needs Focus',\n        message: `${worstCity.name} underperforming at ${formatCurrency(worstCity.revenue)}`,\n        action: `Investigate ${worstCity.name} market. Run local promotions.`\n      });\n    }\n  }\n  \n  const highCODCities = cityArray.filter(c => c.cod_percentage > CONFIG.THRESHOLDS.COD_RISK_THRESHOLD);\n  if (highCODCities.length > 0) {\n    insights.push({\n      type: 'danger',\n      title: 'High COD Risk Cities',\n      message: `${highCODCities.length} cities have >${CONFIG.THRESHOLDS.COD_RISK_THRESHOLD}% COD orders`,\n      action: 'Implement COD verification in these cities'\n    });\n  }\n  \n  const highReturnCities = cityArray.filter(c => c.return_percentage > CONFIG.THRESHOLDS.RETURN_RATE_ALERT);\n  if (highReturnCities.length > 0) {\n    insights.push({\n      type: 'warning',\n      title: 'High Return Rate Cities',\n      message: `${highReturnCities.length} cities have >${CONFIG.THRESHOLDS.RETURN_RATE_ALERT}% returns`,\n      action: 'Review fulfillment quality in these locations'\n    });\n  }\n  \n  return {\n    cities: cityArray,\n    states: stateArray,\n    top_cities: topCities,\n    top_states: topStates,\n    high_cod_cities: highCODCities,\n    high_return_cities: highReturnCities,\n    insights: insights\n  };\n}\n\nfunction analyzePaymentMethods(orders) {\n  const deliveredOrders = orders.filter(o => o.status === 'Delivered');\n  const payments = {};\n  let totalOrders = deliveredOrders.length;\n  \n  deliveredOrders.forEach(order => {\n    const method = order.payment_method || 'Unknown';\n    if (!payments[method]) {\n      payments[method] = {\n        method: method,\n        orders: 0,\n        revenue: 0,\n        profit: 0,\n        avg_value: 0,\n        cities: new Set(),\n        customers: new Set()\n      };\n    }\n    \n    payments[method].orders++;\n    payments[method].revenue += parseFloat(order.revenue) || 0;\n    payments[method].profit += parseFloat(order.profit) || 0;\n    if (order.city) payments[method].cities.add(order.city);\n    if (order.customer_id) payments[method].customers.add(order.customer_id);\n  });\n  \n  const paymentArray = Object.values(payments).map(p => ({\n    ...p,\n    percentage: (p.orders / totalOrders * 100),\n    avg_order_value: p.revenue / p.orders,\n    profit_margin: p.revenue > 0 ? (p.profit / p.revenue * 100) : 0,\n    city_count: p.cities.size,\n    customer_count: p.customers.size\n  }));\n  \n  paymentArray.sort((a, b) => b.orders - a.orders);\n  \n  const insights = [];\n  const codData = paymentArray.find(p => p.method === 'COD');\n  \n  if (codData && codData.percentage > CONFIG.THRESHOLDS.COD_RISK_THRESHOLD) {\n    insights.push({\n      type: 'danger',\n      title: 'High COD Dependency',\n      message: `${formatPercent(codData.percentage)} of orders are COD`,\n      action: 'Launch digital payment campaign with cashback offers'\n    });\n  }\n  \n  const upiData = paymentArray.find(p => p.method === 'UPI');\n  if (upiData && upiData.percentage < 20) {\n    insights.push({\n      type: 'info',\n      title: 'UPI Adoption Opportunity',\n      message: `Only ${formatPercent(upiData.percentage)} of orders use UPI`,\n      action: 'Promote UPI payments with instant discounts'\n    });\n  }\n  \n  return {\n    methods: paymentArray,\n    total_methods: paymentArray.length,\n    cod_percentage: codData ? codData.percentage : 0,\n    insights: insights\n  };\n}\n\nfunction analyzeReturnRate(orders) {\n  const returnedOrders = orders.filter(o => o.status === 'Returned');\n  const deliveredOrders = orders.filter(o => o.status === 'Delivered');\n  const totalOrders = deliveredOrders.length + returnedOrders.length;\n  \n  if (totalOrders === 0) {\n    return {\n      return_rate: 0,\n      returned_orders: 0,\n      revenue_lost: 0,\n      insights: []\n    };\n  }\n  \n  const returnRate = (returnedOrders.length / totalOrders * 100);\n  const revenueLost = returnedOrders.reduce((sum, o) => sum + (parseFloat(o.revenue) || 0), 0);\n  \n  const returnReasons = {};\n  returnedOrders.forEach(order => {\n    const reason = order.return_reason || 'Not Specified';\n    returnReasons[reason] = (returnReasons[reason] || 0) + 1;\n  });\n  \n  const topReasons = Object.entries(returnReasons)\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, 3)\n    .map(([reason, count]) => ({ reason, count }));\n  \n  const insights = [];\n  \n  if (returnRate > CONFIG.THRESHOLDS.RETURN_RATE_ALERT) {\n    insights.push({\n      type: 'danger',\n      title: 'High Return Rate Alert',\n      message: `Return rate is ${returnRate.toFixed(1)}%, exceeding ${CONFIG.THRESHOLDS.RETURN_RATE_ALERT}% threshold`,\n      action: 'Review product quality and shipping processes'\n    });\n    \n    if (topReasons.length > 0) {\n      const mainReason = topReasons[0].reason;\n      insights.push({\n        type: 'warning',\n        title: 'Primary Return Reason',\n        message: `Most returns due to: \"${mainReason}\"`,\n        action: `Address \"${mainReason}\" issue immediately`\n      });\n    }\n  }\n  \n  if (revenueLost > 100000) {\n    insights.push({\n      type: 'warning',\n      title: 'Significant Revenue Loss',\n      message: `Returns caused ${formatCurrency(revenueLost)} revenue loss`,\n      action: 'Implement better quality control and sizing guides'\n    });\n  }\n  \n  return {\n    return_rate: returnRate,\n    returned_orders: returnedOrders.length,\n    revenue_lost: revenueLost,\n    top_reasons: topReasons,\n    insights: insights\n  };\n}\n\nfunction analyzeTimeTrends(orders) {\n  const deliveredOrders = orders.filter(o => o.status === 'Delivered');\n  const dailyTrend = {};\n  const weeklyTrend = {};\n  const monthlyTrend = {};\n  const hourlyTrend = Array(24).fill(0);\n  \n  deliveredOrders.forEach(order => {\n    const date = new Date(order.order_date);\n    const dayKey = date.toISOString().split('T')[0];\n    const weekKey = `${date.getFullYear()}-W${Math.floor(date.getDate()/7)}`;\n    const monthKey = `${date.getFullYear()}-${(date.getMonth()+1).toString().padStart(2,'0')}`;\n    const hour = date.getHours();\n    \n    dailyTrend[dayKey] = (dailyTrend[dayKey] || 0) + (order.revenue || 0);\n    weeklyTrend[weekKey] = (weeklyTrend[weekKey] || 0) + (order.revenue || 0);\n    monthlyTrend[monthKey] = (monthlyTrend[monthKey] || 0) + (order.revenue || 0);\n    hourlyTrend[hour] += (order.revenue || 0);\n  });\n  \n  const dailyArray = Object.entries(dailyTrend).map(([date, revenue]) => ({\n    date,\n    revenue\n  })).sort((a, b) => a.date.localeCompare(b.date));\n  \n  const weeklyArray = Object.entries(weeklyTrend).map(([week, revenue]) => ({\n    week,\n    revenue\n  })).sort((a, b) => a.week.localeCompare(b.week));\n  \n  const monthlyArray = Object.entries(monthlyTrend).map(([month, revenue]) => ({\n    month,\n    revenue\n  })).sort((a, b) => a.month.localeCompare(b.month));\n  \n  const peakHour = hourlyTrend.indexOf(Math.max(...hourlyTrend));\n  \n  return {\n    daily_trend: dailyArray.slice(-30),\n    weekly_trend: weeklyArray.slice(-12),\n    monthly_trend: monthlyArray,\n    hourly_trend: hourlyTrend,\n    peak_hour: peakHour,\n    total_days: Object.keys(dailyTrend).length,\n    avg_daily_revenue: dailyArray.reduce((sum, day) => sum + day.revenue, 0) / dailyArray.length\n  };\n}\n\nfunction analyzeProductStock(products) {\n  const stockAlerts = [];\n  \n  products.forEach(product => {\n    const demandRate = product.orders / 30;\n    const estimatedStockDays = product.quantity / demandRate;\n    \n    if (estimatedStockDays < 7) {\n      stockAlerts.push({\n        product: product.name,\n        current_stock: product.quantity,\n        demand_rate: demandRate.toFixed(1),\n        estimated_days: estimatedStockDays.toFixed(1),\n        severity: estimatedStockDays < 3 ? 'critical' : 'warning'\n      });\n    }\n  });\n  \n  return {\n    stock_alerts: stockAlerts.sort((a, b) => a.estimated_days - b.estimated_days),\n    total_alerts: stockAlerts.length,\n    critical_alerts: stockAlerts.filter(a => a.severity === 'critical').length\n  };\n}\n\n// ============= MAIN PROCESSING FUNCTION =============\nfunction processBusinessIntelligence(orders) {\n  console.log(\"Processing business intelligence...\");\n  \n  const deliveredOrders = orders.filter(o => o.status === 'Delivered');\n  const cancelledOrders = orders.filter(o => o.status === 'Cancelled');\n  const returnedOrders = orders.filter(o => o.status === 'Returned');\n  const pendingOrders = orders.filter(o => o.status === 'Pending');\n  \n  const totalRevenue = deliveredOrders.reduce((sum, o) => sum + (parseFloat(o.revenue) || 0), 0);\n  const totalProfit = deliveredOrders.reduce((sum, o) => sum + (parseFloat(o.profit) || 0), 0);\n  const orderCount = deliveredOrders.length;\n  \n  const customerAnalysis = analyzeCustomerLoyalty(orders);\n  const productAnalysis = analyzeProductPerformance(orders);\n  const locationAnalysis = analyzeLocationTrends(orders);\n  const paymentAnalysis = analyzePaymentMethods(orders);\n  const returnAnalysis = analyzeReturnRate(orders);\n  const timeAnalysis = analyzeTimeTrends(orders);\n  const stockAnalysis = analyzeProductStock(productAnalysis.all_products);\n  \n  const overallInsights = generateOverallInsights({\n    totalRevenue,\n    totalProfit,\n    orderCount,\n    customerAnalysis,\n    productAnalysis,\n    locationAnalysis,\n    paymentAnalysis,\n    returnAnalysis,\n    timeAnalysis,\n    stockAnalysis,\n    cancelledOrders: cancelledOrders.length\n  });\n  \n  return {\n    summary: {\n      total_revenue: Math.round(totalRevenue),\n      total_profit: Math.round(totalProfit),\n      total_orders: orderCount,\n      delivered_orders: deliveredOrders.length,\n      cancelled_orders: cancelledOrders.length,\n      returned_orders: returnedOrders.length,\n      pending_orders: pendingOrders.length,\n      cancellation_rate: orders.length > 0 ? (cancelledOrders.length / orders.length * 100) : 0,\n      avg_order_value: orderCount > 0 ? Math.round(totalRevenue / orderCount) : 0,\n      profit_margin: totalRevenue > 0 ? (totalProfit / totalRevenue * 100) : 0\n    },\n    \n    customer_intelligence: customerAnalysis,\n    product_intelligence: productAnalysis,\n    location_intelligence: locationAnalysis,\n    payment_intelligence: paymentAnalysis,\n    return_intelligence: returnAnalysis,\n    time_intelligence: timeAnalysis,\n    stock_intelligence: stockAnalysis,\n    \n    business_insights: overallInsights,\n    \n    generated_at: new Date().toISOString(),\n    timezone: CONFIG.TIMEZONE\n  };\n}\n\nfunction generateOverallInsights(data) {\n  const insights = [];\n  \n  if (data.totalRevenue > 1000000) {\n    insights.push({\n      type: 'success',\n      title: 'Revenue Milestone',\n      message: `Achieved ${formatCurrency(data.totalRevenue)} in revenue`,\n      priority: 'high'\n    });\n  }\n  \n  if (data.customerAnalysis.loyal_count > 5) {\n    insights.push({\n      type: 'success',\n      title: 'Strong Customer Loyalty',\n      message: `${data.customerAnalysis.loyal_count} loyal customers identified`,\n      priority: 'medium'\n    });\n  }\n  \n  if (data.customerAnalysis.risky_count > 3) {\n    insights.push({\n      type: 'danger',\n      title: 'Risky Customers Detected',\n      message: `${data.customerAnalysis.risky_count} high-risk customers need attention`,\n      priority: 'high'\n    });\n  }\n  \n  if (data.productAnalysis.insights) {\n    insights.push(...data.productAnalysis.insights);\n  }\n  \n  if (data.locationAnalysis.insights) {\n    insights.push(...data.locationAnalysis.insights);\n  }\n  \n  if (data.paymentAnalysis.insights) {\n    insights.push(...data.paymentAnalysis.insights);\n  }\n  \n  if (data.returnAnalysis.insights) {\n    insights.push(...data.returnAnalysis.insights);\n  }\n  \n  if (data.stockAnalysis.critical_alerts > 0) {\n    insights.push({\n      type: 'danger',\n      title: 'Critical Stock Alerts',\n      message: `${data.stockAnalysis.critical_alerts} products with less than 3 days stock`,\n      priority: 'high'\n    });\n  }\n  \n  if (data.timeAnalysis.peak_hour !== -1) {\n    insights.push({\n      type: 'info',\n      title: 'Peak Shopping Hour',\n      message: `Most orders placed between ${data.timeAnalysis.peak_hour}:00 - ${data.timeAnalysis.peak_hour+1}:00`,\n      priority: 'low'\n    });\n  }\n  \n  if (data.cancelledOrders > 0) {\n    const cancellationRate = (data.cancelledOrders / (data.total_orders + data.cancelledOrders) * 100);\n    if (cancellationRate > CONFIG.THRESHOLDS.CANCELLATION_RATE_ALERT) {\n      insights.push({\n        type: 'danger',\n        title: 'High Order Cancellations',\n        message: `${cancellationRate.toFixed(1)}% of orders were cancelled`,\n        priority: 'high'\n      });\n    }\n  }\n  \n  const priorityOrder = { high: 0, medium: 1, low: 2 };\n  return insights.sort((a, b) => \n    (priorityOrder[a.priority || 'medium'] - priorityOrder[b.priority || 'medium'])\n  );\n}\n\n// ============= HTML GENERATOR =============\nfunction generateBusinessDashboard(data) {\n  const timestamp = new Date().toISOString();\n  const reportId = `BI-${Date.now().toString().slice(-8)}`;\n  \n  const html = `\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>${CONFIG.DASHBOARD_NAME} - Business Intelligence</title>\n    <style>\n        :root {\n            --primary-color: #1a237e;\n            --secondary-color: #283593;\n            --success-color: #2e7d32;\n            --warning-color: #f57c00;\n            --danger-color: #c62828;\n            --info-color: #0277bd;\n            --light-color: #f5f7fa;\n            --dark-color: #263238;\n            --card-bg: #ffffff;\n            --border-color: #e0e0e0;\n        }\n        \n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        }\n        \n        body {\n            background-color: #f8fafc;\n            color: var(--dark-color);\n            line-height: 1.6;\n            padding: 20px;\n        }\n        \n        .container {\n            max-width: 1400px;\n            margin: 0 auto;\n        }\n        \n        .header {\n            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));\n            color: white;\n            padding: 30px;\n            border-radius: 12px;\n            margin-bottom: 30px;\n            box-shadow: 0 4px 12px rgba(0,0,0,0.1);\n        }\n        \n        .header h1 {\n            font-size: 32px;\n            font-weight: 700;\n            margin-bottom: 10px;\n        }\n        \n        .header-subtitle {\n            font-size: 16px;\n            opacity: 0.9;\n            margin-bottom: 15px;\n        }\n        \n        .founder-section {\n            background: rgba(255,255,255,0.1);\n            padding: 15px;\n            border-radius: 8px;\n            margin-top: 20px;\n        }\n        \n        .founder-message {\n            font-style: italic;\n            font-size: 14px;\n            margin-bottom: 5px;\n        }\n        \n        .founder-name {\n            text-align: right;\n            font-size: 13px;\n            opacity: 0.8;\n        }\n        \n        .header-info {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 20px;\n            margin-top: 20px;\n            padding-top: 20px;\n            border-top: 1px solid rgba(255,255,255,0.1);\n        }\n        \n        .info-item {\n            display: flex;\n            flex-direction: column;\n        }\n        \n        .info-label {\n            font-size: 12px;\n            opacity: 0.8;\n            margin-bottom: 4px;\n        }\n        \n        .info-value {\n            font-size: 14px;\n            font-weight: 500;\n        }\n        \n        .dashboard-controls {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 25px;\n            padding: 15px;\n            background: white;\n            border-radius: 10px;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n        }\n        \n        .time-display {\n            font-size: 14px;\n            color: #666;\n        }\n        \n        .export-buttons {\n            display: flex;\n            gap: 10px;\n        }\n        \n        .btn {\n            padding: 10px 20px;\n            border: none;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            transition: all 0.3s ease;\n        }\n        \n        .btn-primary {\n            background: var(--primary-color);\n            color: white;\n        }\n        \n        .btn-success {\n            background: var(--success-color);\n            color: white;\n        }\n        \n        .btn-warning {\n            background: var(--warning-color);\n            color: white;\n        }\n        \n        .btn:hover {\n            opacity: 0.9;\n            transform: translateY(-2px);\n        }\n        \n        .insights-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));\n            gap: 25px;\n            margin-bottom: 30px;\n        }\n        \n        .insight-card {\n            background: white;\n            border-radius: 12px;\n            padding: 25px;\n            box-shadow: 0 3px 10px rgba(0,0,0,0.08);\n            border: 1px solid var(--border-color);\n        }\n        \n        .insight-header {\n            display: flex;\n            align-items: center;\n            margin-bottom: 20px;\n            padding-bottom: 15px;\n            border-bottom: 1px solid var(--border-color);\n        }\n        \n        .insight-icon {\n            width: 40px;\n            height: 40px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            margin-right: 15px;\n            font-size: 20px;\n        }\n        \n        .insight-success { background: #d4edda; color: var(--success-color); }\n        .insight-warning { background: #fff3cd; color: var(--warning-color); }\n        .insight-danger { background: #f8d7da; color: var(--danger-color); }\n        .insight-info { background: #d1ecf1; color: var(--info-color); }\n        \n        .insight-title {\n            font-size: 18px;\n            font-weight: 600;\n            color: var(--primary-color);\n        }\n        \n        .insight-content {\n            margin-bottom: 15px;\n        }\n        \n        .insight-message {\n            font-size: 15px;\n            margin-bottom: 10px;\n            line-height: 1.5;\n        }\n        \n        .insight-action {\n            background: var(--light-color);\n            padding: 12px;\n            border-radius: 8px;\n            border-left: 4px solid var(--primary-color);\n            font-size: 14px;\n        }\n        \n        .insight-action strong {\n            color: var(--primary-color);\n        }\n        \n        .metrics-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n            gap: 20px;\n            margin-bottom: 30px;\n        }\n        \n        .metric-card {\n            background: white;\n            border-radius: 10px;\n            padding: 20px;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n            border: 1px solid var(--border-color);\n            text-align: center;\n        }\n        \n        .metric-value {\n            font-size: 32px;\n            font-weight: 700;\n            margin-bottom: 5px;\n        }\n        \n        .metric-label {\n            font-size: 14px;\n            color: #666;\n        }\n        \n        .tables-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));\n            gap: 25px;\n            margin-bottom: 30px;\n        }\n        \n        .table-card {\n            background: white;\n            border-radius: 12px;\n            padding: 25px;\n            box-shadow: 0 3px 10px rgba(0,0,0,0.08);\n            border: 1px solid var(--border-color);\n        }\n        \n        .table-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 20px;\n            padding-bottom: 15px;\n            border-bottom: 1px solid var(--border-color);\n        }\n        \n        .table-title {\n            font-size: 18px;\n            font-weight: 600;\n            color: var(--primary-color);\n        }\n        \n        .table-container {\n            overflow-x: auto;\n        }\n        \n        .data-table {\n            width: 100%;\n            border-collapse: collapse;\n            font-size: 14px;\n        }\n        \n        .data-table th {\n            background: #f8f9fa;\n            color: var(--dark-color);\n            text-align: left;\n            padding: 12px 15px;\n            font-weight: 600;\n            border-bottom: 2px solid var(--border-color);\n        }\n        \n        .data-table td {\n            padding: 12px 15px;\n            border-bottom: 1px solid var(--border-color);\n        }\n        \n        .data-table tr:hover {\n            background: #f8f9fa;\n        }\n        \n        .customer-tier {\n            display: inline-block;\n            padding: 4px 12px;\n            border-radius: 20px;\n            font-size: 12px;\n            font-weight: 600;\n        }\n        \n        .tier-loyal { background: #d4edda; color: var(--success-color); }\n        .tier-regular { background: #d1ecf1; color: var(--info-color); }\n        .tier-new { background: #e2e3e5; color: #6c757d; }\n        \n        .risk-level {\n            display: inline-block;\n            padding: 4px 12px;\n            border-radius: 20px;\n            font-size: 12px;\n            font-weight: 600;\n        }\n        \n        .risk-high { background: #f8d7da; color: var(--danger-color); }\n        .risk-medium { background: #fff3cd; color: var(--warning-color); }\n        .risk-low { background: #d4edda; color: var(--success-color); }\n        \n        .product-status {\n            display: inline-block;\n            padding: 4px 12px;\n            border-radius: 20px;\n            font-size: 12px;\n            font-weight: 600;\n        }\n        \n        .status-best { background: #d4edda; color: var(--success-color); }\n        .status-good { background: #d1ecf1; color: var(--info-color); }\n        .status-low { background: #fff3cd; color: var(--warning-color); }\n        \n        .tabs {\n            display: flex;\n            gap: 10px;\n            margin-bottom: 25px;\n            overflow-x: auto;\n            padding-bottom: 10px;\n        }\n        \n        .tab-btn {\n            padding: 12px 24px;\n            background: white;\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            white-space: nowrap;\n        }\n        \n        .tab-btn.active {\n            background: var(--primary-color);\n            color: white;\n            border-color: var(--primary-color);\n        }\n        \n        .tab-content {\n            display: none;\n        }\n        \n        .tab-content.active {\n            display: block;\n        }\n        \n        .footer {\n            text-align: center;\n            padding: 20px;\n            color: #666;\n            font-size: 14px;\n            border-top: 1px solid var(--border-color);\n            margin-top: 40px;\n        }\n        \n        @media (max-width: 768px) {\n            body {\n                padding: 15px;\n            }\n            \n            .header {\n                padding: 20px;\n            }\n            \n            .header h1 {\n                font-size: 24px;\n            }\n            \n            .dashboard-controls {\n                flex-direction: column;\n                gap: 15px;\n            }\n            \n            .export-buttons {\n                flex-wrap: wrap;\n                justify-content: center;\n            }\n            \n            .insights-grid {\n                grid-template-columns: 1fr;\n            }\n            \n            .tables-grid {\n                grid-template-columns: 1fr;\n            }\n            \n            .metrics-grid {\n                grid-template-columns: repeat(2, 1fr);\n            }\n        }\n        \n        @media (max-width: 480px) {\n            .metrics-grid {\n                grid-template-columns: 1fr;\n            }\n            \n            .btn {\n                padding: 8px 15px;\n                font-size: 13px;\n            }\n            \n            .tab-btn {\n                padding: 8px 16px;\n                font-size: 13px;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"header\">\n            <h1>${CONFIG.DASHBOARD_NAME}</h1>\n            <div class=\"header-subtitle\">Business Intelligence Dashboard</div>\n            \n            <div class=\"founder-section\">\n                <div class=\"founder-message\">\"${CONFIG.FOUNDER_MESSAGE}\"</div>\n                <div class=\"founder-name\">- ${CONFIG.FOUNDER_NAME}</div>\n            </div>\n            \n            <div class=\"header-info\">\n                <div class=\"info-item\">\n                    <div class=\"info-label\">Report ID</div>\n                    <div class=\"info-value\">${reportId}</div>\n                </div>\n                <div class=\"info-item\">\n                    <div class=\"info-label\">Timezone</div>\n                    <div class=\"info-value\">${CONFIG.TIMEZONE}</div>\n                </div>\n                <div class=\"info-item\">\n                    <div class=\"info-label\">Generated</div>\n                    <div class=\"info-value\">${formatDate(timestamp)}</div>\n                </div>\n                <div class=\"info-item\">\n                    <div class=\"info-label\">Orders Processed</div>\n                    <div class=\"info-value\">${data.summary.total_orders}</div>\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"dashboard-controls\">\n            <div class=\"time-display\">\n                Real-time Update: <span id=\"liveTime\">${formatDate(timestamp)}</span>\n            </div>\n            \n            <div class=\"export-buttons\">\n                <button class=\"btn btn-primary\" onclick=\"exportReport()\">\n                    Export Full Report\n                </button>\n                <button class=\"btn btn-success\" onclick=\"exportToExcel()\">\n                    Export to Excel\n                </button>\n                <button class=\"btn btn-warning\" onclick=\"refreshDashboard()\">\n                    Refresh Data\n                </button>\n            </div>\n        </div>\n        \n        <div class=\"tabs\">\n            <button class=\"tab-btn active\" onclick=\"switchTab('overview')\">Business Overview</button>\n            <button class=\"tab-btn\" onclick=\"switchTab('customers')\">Customer Intelligence</button>\n            <button class=\"tab-btn\" onclick=\"switchTab('products')\">Product Performance</button>\n            <button class=\"tab-btn\" onclick=\"switchTab('locations')\">Location Trends</button>\n            <button class=\"tab-btn\" onclick=\"switchTab('payments')\">Payment Analysis</button>\n            <button class=\"tab-btn\" onclick=\"switchTab('returns')\">Return Analysis</button>\n        </div>\n        \n        <div id=\"overviewTab\" class=\"tab-content active\">\n            <div class=\"metrics-grid\">\n                <div class=\"metric-card\">\n                    <div class=\"metric-value revenue\">${formatCurrency(data.summary.total_revenue)}</div>\n                    <div class=\"metric-label\">Total Revenue</div>\n                </div>\n                <div class=\"metric-card\">\n                    <div class=\"metric-value profit\">${formatCurrency(data.summary.total_profit)}</div>\n                    <div class=\"metric-label\">Total Profit</div>\n                </div>\n                <div class=\"metric-card\">\n                    <div class=\"metric-value\">${data.summary.profit_margin.toFixed(1)}%</div>\n                    <div class=\"metric-label\">Profit Margin</div>\n                </div>\n                <div class=\"metric-card\">\n                    <div class=\"metric-value\">${formatCurrency(data.summary.avg_order_value)}</div>\n                    <div class=\"metric-label\">Avg Order Value</div>\n                </div>\n                <div class=\"metric-card\">\n                    <div class=\"metric-value\">${data.summary.total_orders}</div>\n                    <div class=\"metric-label\">Delivered Orders</div>\n                </div>\n                <div class=\"metric-card\">\n                    <div class=\"metric-value cancelled\">${data.summary.cancelled_orders}</div>\n                    <div class=\"metric-label\">Cancelled Orders</div>\n                </div>\n                <div class=\"metric-card\">\n                    <div class=\"metric-value\">${data.customer_intelligence.total_customers}</div>\n                    <div class=\"metric-label\">Unique Customers</div>\n                </div>\n                <div class=\"metric-card\">\n                    <div class=\"metric-value\">${data.product_intelligence.total_products}</div>\n                    <div class=\"metric-label\">Active Products</div>\n                </div>\n            </div>\n            \n            <h2 style=\"margin: 30px 0 20px; color: var(--primary-color);\">Business Intelligence Insights</h2>\n            <div class=\"insights-grid\">\n                ${data.business_insights.map(insight => `\n                    <div class=\"insight-card\">\n                        <div class=\"insight-header\">\n                            <div class=\"insight-icon insight-${insight.type}\">\n                                ${insight.type === 'success' ? 'âœ“' : insight.type === 'warning' ? 'âš ' : insight.type === 'danger' ? 'âœ—' : 'â„¹'}\n                            </div>\n                            <div class=\"insight-title\">${insight.title}</div>\n                        </div>\n                        <div class=\"insight-content\">\n                            <div class=\"insight-message\">${insight.message}</div>\n                            <div class=\"insight-action\">\n                                <strong>Recommended Action:</strong> ${insight.action || 'Review and take necessary action'}\n                            </div>\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            \n            <div class=\"tables-grid\">\n                <div class=\"table-card\">\n                    <div class=\"table-header\">\n                        <div class=\"table-title\">Top 5 Products by Revenue</div>\n                    </div>\n                    <div class=\"table-container\">\n                        <table class=\"data-table\">\n                            <thead>\n                                <tr>\n                                    <th>Product</th>\n                                    <th>Revenue</th>\n                                    <th>Orders</th>\n                                    <th>Margin</th>\n                                    <th>Status</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${data.product_intelligence.top_by_revenue.slice(0, 5).map(product => `\n                                    <tr>\n                                        <td><strong>${product.name}</strong></td>\n                                        <td>${formatCurrency(product.revenue)}</td>\n                                        <td>${product.orders}</td>\n                                        <td>${product.profit_margin.toFixed(1)}%</td>\n                                        <td><span class=\"product-status status-best\">Best Seller</span></td>\n                                    </tr>\n                                `).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n                \n                <div class=\"table-card\">\n                    <div class=\"table-header\">\n                        <div class=\"table-title\">Top 5 Cities by Revenue</div>\n                    </div>\n                    <div class=\"table-container\">\n                        <table class=\"data-table\">\n                            <thead>\n                                <tr>\n                                    <th>City</th>\n                                    <th>Revenue</th>\n                                    <th>Orders</th>\n                                    <th>COD %</th>\n                                    <th>Returns %</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${data.location_intelligence.top_cities.slice(0, 5).map(city => `\n                                    <tr>\n                                        <td><strong>${city.name}</strong></td>\n                                        <td>${formatCurrency(city.revenue)}</td>\n                                        <td>${city.orders}</td>\n                                        <td>${city.cod_percentage.toFixed(1)}%</td>\n                                        <td>${city.return_percentage.toFixed(1)}%</td>\n                                    </tr>\n                                `).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <div id=\"customersTab\" class=\"tab-content\">\n            <div class=\"tables-grid\">\n                <div class=\"table-card\">\n                    <div class=\"table-header\">\n                        <div class=\"table-title\">Top Loyal Customers</div>\n                        <div class=\"info-value\">${data.customer_intelligence.loyal_count} loyal customers</div>\n                    </div>\n                    <div class=\"table-container\">\n                        <table class=\"data-table\">\n                            <thead>\n                                <tr>\n                                    <th>Customer ID</th>\n                                    <th>Orders</th>\n                                    <th>Revenue</th>\n                                    <th>Loyalty Score</th>\n                                    <th>Tier</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${data.customer_intelligence.loyal_customers.map(customer => `\n                                    <tr>\n                                        <td><strong>${customer.id}</strong></td>\n                                        <td>${customer.orders}</td>\n                                        <td>${formatCurrency(customer.total_revenue)}</td>\n                                        <td>${customer.loyalty_score.toFixed(0)}/100</td>\n                                        <td><span class=\"customer-tier tier-loyal\">Loyal</span></td>\n                                    </tr>\n                                `).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n                \n                <div class=\"table-card\">\n                    <div class=\"table-header\">\n                        <div class=\"table-title\">High-Risk Customers</div>\n                        <div class=\"info-value\">${data.customer_intelligence.risky_count} risky customers</div>\n                    </div>\n                    <div class=\"table-container\">\n                        <table class=\"data-table\">\n                            <thead>\n                                <tr>\n                                    <th>Customer ID</th>\n                                    <th>Orders</th>\n                                    <th>Revenue</th>\n                                    <th>Risk Score</th>\n                                    <th>Risk Level</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${data.customer_intelligence.risky_customers.map(customer => `\n                                    <tr>\n                                        <td><strong>${customer.id}</strong></td>\n                                        <td>${customer.orders}</td>\n                                        <td>${formatCurrency(customer.total_revenue)}</td>\n                                        <td>${customer.risk_score.toFixed(0)}/100</td>\n                                        <td><span class=\"risk-level risk-high\">High Risk</span></td>\n                                    </tr>\n                                `).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <div id=\"productsTab\" class=\"tab-content\">\n            <div class=\"tables-grid\">\n                <div class=\"table-card\">\n                    <div class=\"table-header\">\n                        <div class=\"table-title\">Best Performing Products</div>\n                    </div>\n                    <div class=\"table-container\">\n                        <table class=\"data-table\">\n                            <thead>\n                                <tr>\n                                    <th>Product</th>\n                                    <th>Category</th>\n                                    <th>Revenue</th>\n                                    <th>Profit</th>\n                                    <th>Margin</th>\n                                    <th>Orders</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${data.product_intelligence.top_by_revenue.slice(0, 8).map(product => `\n                                    <tr>\n                                        <td><strong>${product.name}</strong></td>\n                                        <td>${product.category}</td>\n                                        <td>${formatCurrency(product.revenue)}</td>\n                                        <td>${formatCurrency(product.profit)}</td>\n                                        <td>${product.profit_margin.toFixed(1)}%</td>\n                                        <td>${product.orders}</td>\n                                    </tr>\n                                `).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n                \n                <div class=\"table-card\">\n                    <div class=\"table-header\">\n                        <div class=\"table-title\">Category Performance</div>\n                    </div>\n                    <div class=\"table-container\">\n                        <table class=\"data-table\">\n                            <thead>\n                                <tr>\n                                    <th>Category</th>\n                                    <th>Revenue</th>\n                                    <th>Orders</th>\n                                    <th>Avg Order Value</th>\n                                    <th>Products</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${data.product_intelligence.categories.map(category => `\n                                    <tr>\n                                        <td><strong>${category.name}</strong></td>\n                                        <td>${formatCurrency(category.revenue)}</td>\n                                        <td>${category.orders}</td>\n                                        <td>${formatCurrency(category.avg_order_value)}</td>\n                                        <td>${category.product_count}</td>\n                                    </tr>\n                                `).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <div id=\"locationsTab\" class=\"tab-content\">\n            <div class=\"tables-grid\">\n                <div class=\"table-card\">\n                    <div class=\"table-header\">\n                        <div class=\"table-title\">Top Cities Performance</div>\n                    </div>\n                    <div class=\"table-container\">\n                        <table class=\"data-table\">\n                            <thead>\n                                <tr>\n                                    <th>City</th>\n                                    <th>Revenue</th>\n                                    <th>Orders</th>\n                                    <th>Avg Order Value</th>\n                                    <th>Customers</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${data.location_intelligence.top_cities.slice(0, 10).map(city => `\n                                    <tr>\n                                        <td><strong>${city.name}</strong></td>\n                                        <td>${formatCurrency(city.revenue)}</td>\n                                        <td>${city.orders}</td>\n                                        <td>${formatCurrency(city.avg_order_value)}</td>\n                                        <td>${city.customer_count}</td>\n                                    </tr>\n                                `).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <div id=\"paymentsTab\" class=\"tab-content\">\n            <div class=\"tables-grid\">\n                <div class=\"table-card\">\n                    <div class=\"table-header\">\n                        <div class=\"table-title\">Payment Methods Analysis</div>\n                    </div>\n                    <div class=\"table-container\">\n                        <table class=\"data-table\">\n                            <thead>\n                                <tr>\n                                    <th>Method</th>\n                                    <th>Orders</th>\n                                    <th>Percentage</th>\n                                    <th>Avg Value</th>\n                                    <th>Margin</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${data.payment_intelligence.methods.map(method => `\n                                    <tr>\n                                        <td><strong>${method.method}</strong></td>\n                                        <td>${method.orders}</td>\n                                        <td>${method.percentage.toFixed(1)}%</td>\n                                        <td>${formatCurrency(method.avg_order_value)}</td>\n                                        <td>${method.profit_margin.toFixed(1)}%</td>\n                                    </tr>\n                                `).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <div id=\"returnsTab\" class=\"tab-content\">\n            <div class=\"tables-grid\">\n                <div class=\"table-card\">\n                    <div class=\"table-header\">\n                        <div class=\"table-title\">Return Analysis</div>\n                    </div>\n                    <div class=\"table-container\">\n                        <table class=\"data-table\">\n                            <thead>\n                                <tr>\n                                    <th>Metric</th>\n                                    <th>Value</th>\n                                    <th>Status</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                <tr>\n                                    <td><strong>Return Rate</strong></td>\n                                    <td>${data.return_intelligence.return_rate.toFixed(1)}%</td>\n                                    <td>\n                                        ${data.return_intelligence.return_rate > CONFIG.THRESHOLDS.RETURN_RATE_ALERT ? \n                                          '<span class=\"risk-level risk-high\">High</span>' : \n                                          '<span class=\"risk-level risk-low\">Normal</span>'}\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td><strong>Returned Orders</strong></td>\n                                    <td>${data.return_intelligence.returned_orders}</td>\n                                    <td></td>\n                                </tr>\n                                <tr>\n                                    <td><strong>Revenue Lost</strong></td>\n                                    <td>${formatCurrency(data.return_intelligence.revenue_lost)}</td>\n                                    <td></td>\n                                </tr>\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"footer\">\n            <div>${CONFIG.DASHBOARD_NAME} â€¢ Business Intelligence Platform</div>\n            <div>Report ID: ${reportId} â€¢ Generated: ${formatDate(timestamp)} â€¢ Timezone: ${CONFIG.TIMEZONE}</div>\n            <div>Auto-refresh: Every 5 minutes â€¢ Real-time Alerts Enabled</div>\n        </div>\n    </div>\n    \n    <script>\n        const dashboardData = ${JSON.stringify(data)};\n        let currentTab = 'overview';\n        \n        function switchTab(tabName) {\n            currentTab = tabName;\n            \n            document.querySelectorAll('.tab-btn').forEach(btn => {\n                btn.classList.remove('active');\n            });\n            event.target.classList.add('active');\n            \n            document.querySelectorAll('.tab-content').forEach(content => {\n                content.classList.remove('active');\n            });\n            document.getElementById(tabName + 'Tab').classList.add('active');\n        }\n        \n        function exportReport() {\n            alert('Full business intelligence report would be generated and downloaded');\n        }\n        \n        function exportToExcel() {\n            alert('Exporting all analytics data to Excel format');\n        }\n        \n        function refreshDashboard() {\n            if (confirm('Refresh dashboard with latest data?')) {\n                location.reload();\n            }\n        }\n        \n        function updateLiveTime() {\n            const now = new Date();\n            const options = {\n                timeZone: '${CONFIG.TIMEZONE}',\n                year: 'numeric',\n                month: 'short',\n                day: 'numeric',\n                hour: '2-digit',\n                minute: '2-digit',\n                second: '2-digit'\n            };\n            const liveTime = now.toLocaleDateString('en-IN', options);\n            document.getElementById('liveTime').textContent = liveTime;\n        }\n        \n        setInterval(() => {\n            console.log('Checking for data refresh...');\n        }, 300000);\n        \n        document.addEventListener('DOMContentLoaded', function() {\n            updateLiveTime();\n            setInterval(updateLiveTime, 1000);\n            \n            const criticalAlerts = dashboardData.business_insights.filter(i => i.type === 'danger');\n            if (criticalAlerts.length > 0) {\n                console.log('Critical alerts detected:', criticalAlerts.length);\n            }\n        });\n    </script>\n</body>\n</html>`;\n\n  return html;\n}\n\n// ============= MAIN EXECUTION =============\ntry {\n  let inputData = null;\n  \n  if (typeof items !== 'undefined' && Array.isArray(items) && items.length > 0) {\n    console.log(\"External data detected:\", items.length, \"items\");\n    \n    if (items[0].json && Array.isArray(items[0].json)) {\n      inputData = items[0].json;\n      console.log(\"Data found in items[0].json array\");\n    } else if (items[0].json && items[0].json.data) {\n      inputData = items[0].json.data;\n      console.log(\"Data found in items[0].json.data\");\n    } else if (items[0].json && items[0].json.orders) {\n      inputData = items[0].json.orders;\n      console.log(\"Data found in items[0].json.orders\");\n    } else if (Array.isArray(items)) {\n      inputData = items;\n      console.log(\"Items is direct array\");\n    }\n  }\n  \n  if (!inputData || inputData.length === 0) {\n    console.log(\"Using enhanced test data\");\n    inputData = [\n      {\n        \"order_id\": \"FINAL1\",\n        \"customer_id\": \"CUST001\",\n        \"revenue\": 100000,\n        \"profit\": 20000,\n        \"status\": \"Delivered\",\n        \"city\": \"Mumbai\",\n        \"payment_method\": \"COD\",\n        \"product_name\": \"iPhone 15\",\n        \"product_category\": \"Electronics\",\n        \"quantity\": 1,\n        \"order_date\": \"2024-01-15\"\n      },\n      {\n        \"order_id\": \"FINAL2\",\n        \"customer_id\": \"CUST001\",\n        \"revenue\": 200000,\n        \"profit\": 40000,\n        \"status\": \"Delivered\",\n        \"city\": \"Delhi\",\n        \"payment_method\": \"Card\",\n        \"product_name\": \"MacBook Pro\",\n        \"product_category\": \"Electronics\",\n        \"quantity\": 1,\n        \"order_date\": \"2024-01-20\"\n      },\n      {\n        \"order_id\": \"FINAL3\",\n        \"customer_id\": \"CUST002\",\n        \"revenue\": 300000,\n        \"profit\": 60000,\n        \"status\": \"Cancelled\",\n        \"city\": \"Mumbai\",\n        \"payment_method\": \"COD\",\n        \"product_name\": \"Samsung TV\",\n        \"product_category\": \"Electronics\",\n        \"quantity\": 1,\n        \"order_date\": \"2024-01-25\"\n      },\n      {\n        \"order_id\": \"FINAL4\",\n        \"customer_id\": \"CUST003\",\n        \"revenue\": 400000,\n        \"profit\": 80000,\n        \"status\": \"Delivered\",\n        \"city\": \"Bangalore\",\n        \"payment_method\": \"UPI\",\n        \"product_name\": \"Sofa Set\",\n        \"product_category\": \"Furniture\",\n        \"quantity\": 1,\n        \"order_date\": \"2024-02-01\"\n      },\n      {\n        \"order_id\": \"FINAL5\",\n        \"customer_id\": \"CUST004\",\n        \"revenue\": 25000,\n        \"profit\": 5000,\n        \"status\": \"Delivered\",\n        \"city\": \"Chennai\",\n        \"payment_method\": \"COD\",\n        \"product_name\": \"Desk Lamp\",\n        \"product_category\": \"Home Decor\",\n        \"quantity\": 1,\n        \"order_date\": \"2024-02-05\"\n      },\n      {\n        \"order_id\": \"FINAL6\",\n        \"customer_id\": \"CUST001\",\n        \"revenue\": 150000,\n        \"profit\": 30000,\n        \"status\": \"Returned\",\n        \"city\": \"Mumbai\",\n        \"payment_method\": \"COD\",\n        \"product_name\": \"Gaming Console\",\n        \"product_category\": \"Electronics\",\n        \"quantity\": 1,\n        \"order_date\": \"2024-02-10\",\n        \"return_reason\": \"Damaged in shipping\"\n      }\n    ];\n  }\n  \n  console.log(\"Processing business intelligence...\");\n  const businessData = processBusinessIntelligence(inputData);\n  \n  businessData.report_id = \"BI-\" + Date.now().toString().slice(-8);\n  \n  console.log(\"=== BUSINESS INTELLIGENCE DASHBOARD GENERATED ===\");\n  console.log(\"Report ID:\", businessData.report_id);\n  console.log(\"Total Revenue:\", formatCurrency(businessData.summary.total_revenue));\n  console.log(\"Loyal Customers:\", businessData.customer_intelligence.loyal_count);\n  console.log(\"Risky Customers:\", businessData.customer_intelligence.risky_count);\n  console.log(\"Business Insights:\", businessData.business_insights.length);\n  \n  const htmlDashboard = generateBusinessDashboard(businessData);\n  \n  return [{\n    json: {\n      data: businessData,\n      html: htmlDashboard,\n      metadata: {\n        generated_at: new Date().toISOString(),\n        status: \"success\",\n        format: \"business_intelligence_dashboard\",\n        report_id: businessData.report_id,\n        timezone: CONFIG.TIMEZONE,\n        features: [\n          \"Loyal Customer Analysis\",\n          \"Risky Customer Detection\",\n          \"Product Performance Insights\",\n          \"Location Trend Analysis\",\n          \"Payment Method Analytics\",\n          \"Return Rate Analysis\",\n          \"Time Trend Analysis\",\n          \"Stock Level Monitoring\",\n          \"Automated Recommendations\"\n        ]\n      }\n    }\n  }];\n  \n} catch (error) {\n  console.error(\"Error processing business intelligence:\", error);\n  \n  const errorHtml = `\n<!DOCTYPE html>\n<html>\n<head>\n    <style>\n        body {\n            font-family: sans-serif;\n            padding: 40px;\n            background: #f8fafc;\n            color: #263238;\n        }\n        .error-container {\n            max-width: 600px;\n            margin: 0 auto;\n            background: white;\n            padding: 30px;\n            border-radius: 10px;\n            box-shadow: 0 2px 20px rgba(0,0,0,0.1);\n            text-align: center;\n        }\n        h2 {\n            color: #c62828;\n            margin-bottom: 20px;\n        }\n        .retry-btn {\n            background: #1a237e;\n            color: white;\n            border: none;\n            padding: 12px 24px;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 14px;\n            margin-top: 20px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"error-container\">\n        <h2>Business Intelligence Dashboard Error</h2>\n        <p>Failed to generate analytics dashboard. Please try again.</p>\n        <div style=\"background: #f8d7da; padding: 15px; border-radius: 5px; margin-top: 20px; font-size: 12px; color: #721c24;\">\n            Error: ${error.message || 'Unknown error'}\n        </div>\n        <button onclick=\"location.reload()\" class=\"retry-btn\">Retry Dashboard</button>\n    </div>\n</body>\n</html>`;\n  \n  return [{\n    json: {\n      error: true,\n      message: \"Failed to generate business intelligence dashboard\",\n      html: errorHtml,\n      error_details: error.message,\n      timestamp: new Date().toISOString()\n    }\n  }];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1888,
        -96
      ],
      "id": "bbeabb7d-5cdb-4839-9aa4-e7980af883f3",
      "name": "Basic UI"
    },
    {
      "parameters": {
        "jsCode": "// ============= FLOWLYTICS AI BUSINESS INTELLIGENCE PROCESSOR =============\n// Version: 2.0 - Fixed data format handling\n// Compatible with {{ $json.html }}\n\nconsole.log(\"=== FLOWLYTICS AI PROCESSOR STARTING ===\");\n\n// ============= CONFIGURATION =============\nconst CONFIG = {\n    DASHBOARD_NAME: \"Flowlytics AI\",\n    FOUNDER_NAME: \"Atha\",\n    FOUNDER_MESSAGE: \"Intelligent Analytics for Smarter Decisions\",\n    TIMEZONE: \"Asia/Kolkata\"\n};\n\n// ============= DATA FORMAT HANDLER =============\nfunction getOrdersData(input) {\n    console.log(\"Input type:\", typeof input);\n    console.log(\"Is array?\", Array.isArray(input));\n    \n    // If input is already an array of orders\n    if (Array.isArray(input)) {\n        console.log(\"Input is direct array, length:\", input.length);\n        \n        // Check if it's an array of order objects\n        if (input.length > 0 && typeof input[0] === 'object') {\n            // Check if first item has .json property\n            if (input[0].json) {\n                console.log(\"Found .json property in first item\");\n                if (Array.isArray(input[0].json)) {\n                    return input[0].json;\n                } else if (input[0].json.data && Array.isArray(input[0].json.data)) {\n                    return input[0].json.data;\n                }\n            }\n            return input;\n        }\n    }\n    \n    // If input is an object\n    if (typeof input === 'object' && input !== null) {\n        console.log(\"Input is object, keys:\", Object.keys(input));\n        \n        // Check common data structures\n        if (input.data && Array.isArray(input.data)) {\n            return input.data;\n        }\n        if (input.orders && Array.isArray(input.orders)) {\n            return input.orders;\n        }\n        if (input.json && Array.isArray(input.json)) {\n            return input.json;\n        }\n        if (Array.isArray(input.json?.data)) {\n            return input.json.data;\n        }\n        \n        // If it's a single order object, wrap in array\n        if (input.order_id || input.customer_id || input.revenue) {\n            return [input];\n        }\n    }\n    \n    // If no valid data found, return empty array\n    console.log(\"No valid order data found, returning empty array\");\n    return [];\n}\n\n// ============= HELPER FUNCTIONS =============\nfunction formatCurrency(value) {\n    if (!value && value !== 0) return \"â‚¹0\";\n    return \"â‚¹\" + parseInt(value).toLocaleString(\"en-IN\");\n}\n\nfunction formatPercent(value) {\n    if (!value && value !== 0) return \"0.0%\";\n    return parseFloat(value).toFixed(1) + \"%\";\n}\n\nfunction formatDate(dateString) {\n    if (!dateString) return \"N/A\";\n    try {\n        const date = new Date(dateString);\n        return date.toLocaleDateString(\"en-IN\", {\n            timeZone: CONFIG.TIMEZONE,\n            year: \"numeric\",\n            month: \"short\",\n            day: \"numeric\"\n        });\n    } catch (e) {\n        return dateString;\n    }\n}\n\n// ============= ANALYTICS FUNCTIONS =============\nfunction calculateBasicMetrics(orders) {\n    if (!Array.isArray(orders) || orders.length === 0) {\n        return {\n            total_revenue: 0,\n            total_profit: 0,\n            total_orders: 0,\n            delivered_orders: 0,\n            cancelled_orders: 0,\n            returned_orders: 0,\n            cancellation_rate: 0,\n            avg_order_value: 0,\n            profit_margin: 0\n        };\n    }\n    \n    const delivered = orders.filter(o => o.status === \"Delivered\");\n    const cancelled = orders.filter(o => o.status === \"Cancelled\");\n    const returned = orders.filter(o => o.status === \"Returned\");\n    \n    const totalRevenue = delivered.reduce((sum, o) => sum + (parseFloat(o.revenue) || 0), 0);\n    const totalProfit = delivered.reduce((sum, o) => sum + (parseFloat(o.profit) || 0), 0);\n    const orderCount = delivered.length;\n    \n    return {\n        total_revenue: Math.round(totalRevenue),\n        total_profit: Math.round(totalProfit),\n        total_orders: orderCount,\n        delivered_orders: delivered.length,\n        cancelled_orders: cancelled.length,\n        returned_orders: returned.length,\n        cancellation_rate: orders.length > 0 ? (cancelled.length / orders.length * 100) : 0,\n        avg_order_value: orderCount > 0 ? Math.round(totalRevenue / orderCount) : 0,\n        profit_margin: totalRevenue > 0 ? (totalProfit / totalRevenue * 100) : 0\n    };\n}\n\nfunction analyzeProducts(orders) {\n    if (!Array.isArray(orders) || orders.length === 0) {\n        return {\n            all_products: [],\n            top_products: [],\n            categories: [],\n            total_products: 0,\n            total_categories: 0\n        };\n    }\n    \n    const delivered = orders.filter(o => o.status === \"Delivered\");\n    const products = {};\n    const categories = {};\n    \n    delivered.forEach(order => {\n        const productId = order.product_id || order.product_name || \"unknown_\" + Math.random();\n        const productName = order.product_name || \"Product \" + productId;\n        const category = order.product_category || order.category || \"Uncategorized\";\n        \n        if (!products[productId]) {\n            products[productId] = {\n                id: productId,\n                name: productName,\n                category: category,\n                orders: 0,\n                revenue: 0,\n                profit: 0,\n                quantity: 0\n            };\n        }\n        \n        const p = products[productId];\n        p.orders++;\n        p.revenue += parseFloat(order.revenue) || 0;\n        p.profit += parseFloat(order.profit) || 0;\n        p.quantity += parseFloat(order.quantity) || 1;\n        \n        if (!categories[category]) {\n            categories[category] = {\n                name: category,\n                revenue: 0,\n                orders: 0,\n                products: new Set()\n            };\n        }\n        \n        categories[category].revenue += parseFloat(order.revenue) || 0;\n        categories[category].orders++;\n        categories[category].products.add(productId);\n    });\n    \n    const productArray = Object.values(products).map(p => ({\n        ...p,\n        profit_margin: p.revenue > 0 ? (p.profit / p.revenue * 100) : 0,\n        avg_price: p.revenue / p.quantity\n    }));\n    \n    const categoryArray = Object.values(categories).map(c => ({\n        ...c,\n        avg_order_value: c.revenue / c.orders,\n        product_count: c.products.size\n    }));\n    \n    const topProducts = [...productArray].sort((a, b) => b.revenue - a.revenue);\n    const topCategories = [...categoryArray].sort((a, b) => b.revenue - a.revenue);\n    \n    return {\n        all_products: productArray,\n        top_products: topProducts.slice(0, 10),\n        categories: topCategories,\n        total_products: productArray.length,\n        total_categories: categoryArray.length\n    };\n}\n\nfunction analyzeLocations(orders) {\n    if (!Array.isArray(orders) || orders.length === 0) {\n        return {\n            cities: [],\n            top_cities: [],\n            high_cod_cities: []\n        };\n    }\n    \n    const delivered = orders.filter(o => o.status === \"Delivered\");\n    const cities = {};\n    \n    delivered.forEach(order => {\n        const city = order.city || \"Unknown\";\n        if (!cities[city]) {\n            cities[city] = {\n                name: city,\n                revenue: 0,\n                orders: 0,\n                profit: 0,\n                cod_orders: 0,\n                customers: new Set()\n            };\n        }\n        \n        const c = cities[city];\n        c.revenue += parseFloat(order.revenue) || 0;\n        c.orders++;\n        c.profit += parseFloat(order.profit) || 0;\n        if (order.payment_method === \"COD\") c.cod_orders++;\n        if (order.customer_id) c.customers.add(order.customer_id);\n    });\n    \n    const cityArray = Object.values(cities).map(c => ({\n        ...c,\n        avg_order_value: c.orders > 0 ? c.revenue / c.orders : 0,\n        profit_margin: c.revenue > 0 ? (c.profit / c.revenue * 100) : 0,\n        cod_percentage: c.orders > 0 ? (c.cod_orders / c.orders * 100) : 0,\n        customer_count: c.customers.size\n    }));\n    \n    const topCities = cityArray.sort((a, b) => b.revenue - a.revenue);\n    const highCODCities = cityArray.filter(c => c.cod_percentage > 30);\n    \n    return {\n        cities: cityArray,\n        top_cities: topCities.slice(0, 10),\n        high_cod_cities: highCODCities\n    };\n}\n\nfunction analyzePayments(orders) {\n    if (!Array.isArray(orders) || orders.length === 0) {\n        return {\n            methods: [],\n            total_methods: 0\n        };\n    }\n    \n    const delivered = orders.filter(o => o.status === \"Delivered\");\n    const payments = {};\n    const totalOrders = delivered.length;\n    \n    delivered.forEach(order => {\n        const method = order.payment_method || \"Unknown\";\n        if (!payments[method]) {\n            payments[method] = {\n                method: method,\n                orders: 0,\n                revenue: 0,\n                profit: 0\n            };\n        }\n        \n        payments[method].orders++;\n        payments[method].revenue += parseFloat(order.revenue) || 0;\n        payments[method].profit += parseFloat(order.profit) || 0;\n    });\n    \n    const paymentArray = Object.values(payments).map(p => ({\n        ...p,\n        percentage: totalOrders > 0 ? (p.orders / totalOrders * 100) : 0,\n        avg_order_value: p.orders > 0 ? p.revenue / p.orders : 0,\n        profit_margin: p.revenue > 0 ? (p.profit / p.revenue * 100) : 0\n    }));\n    \n    paymentArray.sort((a, b) => b.orders - a.orders);\n    \n    return {\n        methods: paymentArray,\n        total_methods: paymentArray.length\n    };\n}\n\nfunction analyzeCustomers(orders) {\n    if (!Array.isArray(orders) || orders.length === 0) {\n        return {\n            all_customers: [],\n            repeat_customers: [],\n            total_customers: 0,\n            repeat_count: 0,\n            repeat_rate: 0,\n            avg_customer_value: 0\n        };\n    }\n    \n    const delivered = orders.filter(o => o.status === \"Delivered\");\n    const customers = {};\n    \n    delivered.forEach(order => {\n        const custId = order.customer_id || \"anonymous_\" + Math.random();\n        if (!customers[custId]) {\n            customers[custId] = {\n                id: custId,\n                orders: 0,\n                total_revenue: 0,\n                total_profit: 0,\n                cities: new Set(),\n                first_order: order.order_date,\n                last_order: order.order_date\n            };\n        }\n        \n        customers[custId].orders++;\n        customers[custId].total_revenue += parseFloat(order.revenue) || 0;\n        customers[custId].total_profit += parseFloat(order.profit) || 0;\n        if (order.city) customers[custId].cities.add(order.city);\n        customers[custId].last_order = order.order_date;\n    });\n    \n    const customerArray = Object.values(customers);\n    const repeatCustomers = customerArray.filter(c => c.orders > 1);\n    \n    return {\n        all_customers: customerArray,\n        repeat_customers: repeatCustomers,\n        total_customers: customerArray.length,\n        repeat_count: repeatCustomers.length,\n        repeat_rate: customerArray.length > 0 ? (repeatCustomers.length / customerArray.length * 100) : 0,\n        avg_customer_value: customerArray.length > 0 ? \n            customerArray.reduce((sum, c) => sum + c.total_revenue, 0) / customerArray.length : 0\n    };\n}\n\nfunction generateInsights(data) {\n    const insights = [];\n    \n    if (data.metrics.total_revenue > 1000000) {\n        insights.push({\n            type: \"success\",\n            title: \"Revenue Milestone\",\n            message: `Achieved ${formatCurrency(data.metrics.total_revenue)} in revenue`,\n            action: \"Review performance and plan next quarter targets\"\n        });\n    }\n    \n    if (data.products.top_products.length > 0) {\n        const bestProduct = data.products.top_products[0];\n        insights.push({\n            type: \"success\",\n            title: \"Top Product Identified\",\n            message: `${bestProduct.name} is your top performer with ${formatCurrency(bestProduct.revenue)} revenue`,\n            action: \"Increase stock and marketing for this product\"\n        });\n    }\n    \n    if (data.products.categories.length > 0) {\n        const bestCategory = data.products.categories[0];\n        if (bestCategory.name !== \"Uncategorized\") {\n            insights.push({\n                type: \"info\",\n                title: \"Best Performing Category\",\n                message: `${bestCategory.name} category leads with ${formatCurrency(bestCategory.revenue)}`,\n                action: `Expand ${bestCategory.name} product range`\n            });\n        }\n    }\n    \n    if (data.locations.top_cities.length > 0) {\n        const bestCity = data.locations.top_cities[0];\n        insights.push({\n            type: \"success\",\n            title: \"Top Performing City\",\n            message: `${bestCity.name} leads with ${formatCurrency(bestCity.revenue)}`,\n            action: `Expand operations in ${bestCity.name}`\n        });\n    }\n    \n    if (data.locations.high_cod_cities.length > 0) {\n        insights.push({\n            type: \"danger\",\n            title: \"High COD Risk Cities\",\n            message: `${data.locations.high_cod_cities.length} cities have >30% COD orders`,\n            action: \"Implement COD verification in these cities\"\n        });\n    }\n    \n    if (data.metrics.cancellation_rate > 10) {\n        insights.push({\n            type: \"danger\",\n            title: \"High Cancellation Rate\",\n            message: `Cancellation rate is ${data.metrics.cancellation_rate.toFixed(1)}%`,\n            action: \"Investigate cancellation reasons and improve process\"\n        });\n    }\n    \n    if (insights.length === 0) {\n        insights.push({\n            type: \"info\",\n            title: \"Dashboard Loaded\",\n            message: \"Business intelligence dashboard has been generated successfully\",\n            action: \"Review the metrics and insights below\"\n        });\n    }\n    \n    return insights;\n}\n\n// ============= MAIN PROCESSING FUNCTION =============\nfunction processData(orders) {\n    console.log(\"Processing orders array, length:\", orders.length);\n    \n    const metrics = calculateBasicMetrics(orders);\n    const products = analyzeProducts(orders);\n    const locations = analyzeLocations(orders);\n    const payments = analyzePayments(orders);\n    const customers = analyzeCustomers(orders);\n    const insights = generateInsights({ metrics, products, locations, payments, customers });\n    \n    return {\n        metrics,\n        products,\n        locations,\n        payments,\n        customers,\n        insights,\n        generated_at: new Date().toISOString(),\n        timezone: CONFIG.TIMEZONE\n    };\n}\n\n// ============= HTML GENERATOR =============\nfunction generateDashboardHTML(data) {\n    const reportId = \"BI-\" + Date.now().toString().slice(-8);\n    const timestamp = new Date().toISOString();\n    \n    return `\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>${CONFIG.DASHBOARD_NAME} - Business Intelligence</title>\n    <style>\n        :root {\n            --primary: #1a237e;\n            --primary-light: #283593;\n            --success: #2e7d32;\n            --warning: #f57c00;\n            --danger: #c62828;\n            --info: #0277bd;\n            --gray-50: #fafafa;\n            --gray-100: #f5f5f5;\n            --gray-200: #eeeeee;\n            --gray-700: #616161;\n            --gray-900: #212121;\n        }\n        \n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        }\n        \n        body {\n            background: #f8fafc;\n            color: var(--gray-900);\n            line-height: 1.6;\n            padding: 20px;\n        }\n        \n        .container {\n            max-width: 1400px;\n            margin: 0 auto;\n        }\n        \n        .header {\n            background: var(--primary);\n            color: white;\n            padding: 30px;\n            border-radius: 12px;\n            margin-bottom: 30px;\n        }\n        \n        .header h1 {\n            font-size: 32px;\n            font-weight: 600;\n            margin-bottom: 8px;\n        }\n        \n        .header-subtitle {\n            font-size: 16px;\n            opacity: 0.9;\n            margin-bottom: 20px;\n        }\n        \n        .header-info {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 20px;\n            padding-top: 20px;\n            border-top: 1px solid rgba(255,255,255,0.1);\n        }\n        \n        .info-item {\n            display: flex;\n            flex-direction: column;\n        }\n        \n        .info-label {\n            font-size: 12px;\n            opacity: 0.8;\n            margin-bottom: 4px;\n        }\n        \n        .info-value {\n            font-size: 14px;\n            font-weight: 500;\n        }\n        \n        .metrics-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n            gap: 20px;\n            margin-bottom: 30px;\n        }\n        \n        .metric-card {\n            background: white;\n            border-radius: 10px;\n            padding: 25px;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n            border: 1px solid var(--gray-200);\n            text-align: center;\n        }\n        \n        .metric-value {\n            font-size: 32px;\n            font-weight: 700;\n            margin-bottom: 8px;\n            color: var(--primary);\n        }\n        \n        .metric-label {\n            font-size: 14px;\n            color: var(--gray-700);\n        }\n        \n        .insights-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));\n            gap: 20px;\n            margin-bottom: 30px;\n        }\n        \n        .insight-card {\n            background: white;\n            border-radius: 10px;\n            padding: 25px;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n            border: 1px solid var(--gray-200);\n            border-left: 4px solid var(--primary);\n        }\n        \n        .insight-header {\n            display: flex;\n            align-items: center;\n            margin-bottom: 15px;\n        }\n        \n        .insight-icon {\n            width: 32px;\n            height: 32px;\n            border-radius: 6px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            margin-right: 12px;\n            font-weight: 600;\n        }\n        \n        .icon-success { background: #e8f5e9; color: var(--success); }\n        .icon-warning { background: #fff3e0; color: var(--warning); }\n        .icon-danger { background: #ffebee; color: var(--danger); }\n        .icon-info { background: #e1f5fe; color: var(--info); }\n        \n        .insight-title {\n            font-size: 16px;\n            font-weight: 600;\n            color: var(--gray-900);\n        }\n        \n        .insight-message {\n            margin-bottom: 12px;\n            color: var(--gray-700);\n        }\n        \n        .insight-action {\n            padding: 12px;\n            background: var(--gray-50);\n            border-radius: 6px;\n            font-size: 14px;\n            color: var(--gray-700);\n        }\n        \n        .tables-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));\n            gap: 25px;\n            margin-bottom: 30px;\n        }\n        \n        .table-card {\n            background: white;\n            border-radius: 10px;\n            padding: 25px;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n            border: 1px solid var(--gray-200);\n        }\n        \n        .table-title {\n            font-size: 18px;\n            font-weight: 600;\n            color: var(--primary);\n            margin-bottom: 20px;\n            padding-bottom: 15px;\n            border-bottom: 1px solid var(--gray-200);\n        }\n        \n        .table-container {\n            overflow-x: auto;\n        }\n        \n        .data-table {\n            width: 100%;\n            border-collapse: collapse;\n            font-size: 14px;\n        }\n        \n        .data-table th {\n            background: var(--gray-50);\n            color: var(--gray-900);\n            text-align: left;\n            padding: 12px 15px;\n            font-weight: 600;\n            border-bottom: 2px solid var(--gray-200);\n        }\n        \n        .data-table td {\n            padding: 12px 15px;\n            border-bottom: 1px solid var(--gray-200);\n        }\n        \n        .data-table tr:hover {\n            background: var(--gray-50);\n        }\n        \n        .status-badge {\n            display: inline-block;\n            padding: 4px 12px;\n            border-radius: 12px;\n            font-size: 12px;\n            font-weight: 600;\n        }\n        \n        .status-success { background: #e8f5e9; color: var(--success); }\n        .status-warning { background: #fff3e0; color: var(--warning); }\n        .status-danger { background: #ffebee; color: var(--danger); }\n        \n        .footer {\n            text-align: center;\n            padding: 25px;\n            color: var(--gray-700);\n            font-size: 14px;\n            border-top: 1px solid var(--gray-200);\n            margin-top: 40px;\n        }\n        \n        @media (max-width: 768px) {\n            body {\n                padding: 15px;\n            }\n            \n            .header {\n                padding: 20px;\n            }\n            \n            .tables-grid {\n                grid-template-columns: 1fr;\n            }\n            \n            .insights-grid {\n                grid-template-columns: 1fr;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"header\">\n            <h1>${CONFIG.DASHBOARD_NAME}</h1>\n            <div class=\"header-subtitle\">Business Intelligence Dashboard</div>\n            <div class=\"header-info\">\n                <div class=\"info-item\">\n                    <div class=\"info-label\">Report ID</div>\n                    <div class=\"info-value\">${reportId}</div>\n                </div>\n                <div class=\"info-item\">\n                    <div class=\"info-label\">Generated</div>\n                    <div class=\"info-value\">${formatDate(timestamp)}</div>\n                </div>\n                <div class=\"info-item\">\n                    <div class=\"info-label\">Timezone</div>\n                    <div class=\"info-value\">${CONFIG.TIMEZONE}</div>\n                </div>\n                <div class=\"info-item\">\n                    <div class=\"info-label\">Orders Processed</div>\n                    <div class=\"info-value\">${data.metrics.total_orders}</div>\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"metrics-grid\">\n            <div class=\"metric-card\">\n                <div class=\"metric-value\">${formatCurrency(data.metrics.total_revenue)}</div>\n                <div class=\"metric-label\">Total Revenue</div>\n            </div>\n            <div class=\"metric-card\">\n                <div class=\"metric-value\">${formatCurrency(data.metrics.total_profit)}</div>\n                <div class=\"metric-label\">Total Profit</div>\n            </div>\n            <div class=\"metric-card\">\n                <div class=\"metric-value\">${data.metrics.profit_margin.toFixed(1)}%</div>\n                <div class=\"metric-label\">Profit Margin</div>\n            </div>\n            <div class=\"metric-card\">\n                <div class=\"metric-value\">${formatCurrency(data.metrics.avg_order_value)}</div>\n                <div class=\"metric-label\">Average Order Value</div>\n            </div>\n            <div class=\"metric-card\">\n                <div class=\"metric-value\">${data.metrics.delivered_orders}</div>\n                <div class=\"metric-label\">Delivered Orders</div>\n            </div>\n            <div class=\"metric-card\">\n                <div class=\"metric-value\">${data.metrics.cancelled_orders}</div>\n                <div class=\"metric-label\">Cancelled Orders</div>\n            </div>\n            <div class=\"metric-card\">\n                <div class=\"metric-value\">${data.customers.total_customers}</div>\n                <div class=\"metric-label\">Unique Customers</div>\n            </div>\n            <div class=\"metric-card\">\n                <div class=\"metric-value\">${data.products.total_products}</div>\n                <div class=\"metric-label\">Active Products</div>\n            </div>\n        </div>\n        \n        <h2 style=\"margin-bottom: 20px; color: var(--primary);\">Business Intelligence Insights</h2>\n        <div class=\"insights-grid\">\n            ${data.insights.map(insight => {\n                const iconClass = `icon-${insight.type}`;\n                const iconText = insight.type === 'success' ? 'âœ“' : \n                               insight.type === 'warning' ? '!' : \n                               insight.type === 'danger' ? 'âœ—' : 'i';\n                return `\n                <div class=\"insight-card\">\n                    <div class=\"insight-header\">\n                        <div class=\"insight-icon ${iconClass}\">${iconText}</div>\n                        <div class=\"insight-title\">${insight.title}</div>\n                    </div>\n                    <div class=\"insight-message\">${insight.message}</div>\n                    <div class=\"insight-action\">Recommended Action: ${insight.action}</div>\n                </div>\n                `;\n            }).join('')}\n        </div>\n        \n        <div class=\"tables-grid\">\n            ${data.products.top_products.length > 0 ? `\n            <div class=\"table-card\">\n                <div class=\"table-title\">Top Products by Revenue</div>\n                <div class=\"table-container\">\n                    <table class=\"data-table\">\n                        <thead>\n                            <tr>\n                                <th>Product</th>\n                                <th>Revenue</th>\n                                <th>Orders</th>\n                                <th>Margin</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            ${data.products.top_products.slice(0, 5).map(product => `\n                                <tr>\n                                    <td><strong>${product.name}</strong></td>\n                                    <td>${formatCurrency(product.revenue)}</td>\n                                    <td>${product.orders}</td>\n                                    <td>${product.profit_margin.toFixed(1)}%</td>\n                                </tr>\n                            `).join('')}\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n            ` : ''}\n            \n            ${data.locations.top_cities.length > 0 ? `\n            <div class=\"table-card\">\n                <div class=\"table-title\">Top Cities by Revenue</div>\n                <div class=\"table-container\">\n                    <table class=\"data-table\">\n                        <thead>\n                            <tr>\n                                <th>City</th>\n                                <th>Revenue</th>\n                                <th>Orders</th>\n                                <th>Avg Value</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            ${data.locations.top_cities.slice(0, 5).map(city => `\n                                <tr>\n                                    <td><strong>${city.name}</strong></td>\n                                    <td>${formatCurrency(city.revenue)}</td>\n                                    <td>${city.orders}</td>\n                                    <td>${formatCurrency(city.avg_order_value)}</td>\n                                </tr>\n                            `).join('')}\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n            ` : ''}\n            \n            ${data.payments.methods.length > 0 ? `\n            <div class=\"table-card\">\n                <div class=\"table-title\">Payment Methods</div>\n                <div class=\"table-container\">\n                    <table class=\"data-table\">\n                        <thead>\n                            <tr>\n                                <th>Method</th>\n                                <th>Orders</th>\n                                <th>Percentage</th>\n                                <th>Avg Value</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            ${data.payments.methods.map(method => `\n                                <tr>\n                                    <td><strong>${method.method}</strong></td>\n                                    <td>${method.orders}</td>\n                                    <td>${method.percentage.toFixed(1)}%</td>\n                                    <td>${formatCurrency(method.avg_order_value)}</td>\n                                </tr>\n                            `).join('')}\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n            ` : ''}\n            \n            <div class=\"table-card\">\n                <div class=\"table-title\">Performance Summary</div>\n                <div class=\"table-container\">\n                    <table class=\"data-table\">\n                        <thead>\n                            <tr>\n                                <th>Metric</th>\n                                <th>Value</th>\n                                <th>Status</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <tr>\n                                <td>Total Customers</td>\n                                <td>${data.customers.total_customers}</td>\n                                <td><span class=\"status-badge status-success\">Active</span></td>\n                            </tr>\n                            <tr>\n                                <td>Repeat Rate</td>\n                                <td>${data.customers.repeat_rate.toFixed(1)}%</td>\n                                <td><span class=\"status-badge ${data.customers.repeat_rate > 20 ? 'status-success' : 'status-warning'}\">${data.customers.repeat_rate > 20 ? 'Good' : 'Needs Focus'}</span></td>\n                            </tr>\n                            <tr>\n                                <td>Cancellation Rate</td>\n                                <td>${data.metrics.cancellation_rate.toFixed(1)}%</td>\n                                <td><span class=\"status-badge ${data.metrics.cancellation_rate > 10 ? 'status-danger' : 'status-success'}\">${data.metrics.cancellation_rate > 10 ? 'High' : 'Normal'}</span></td>\n                            </tr>\n                            <tr>\n                                <td>Active Products</td>\n                                <td>${data.products.total_products}</td>\n                                <td><span class=\"status-badge status-info\">Catalog</span></td>\n                            </tr>\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"footer\">\n            <div>${CONFIG.DASHBOARD_NAME} â€¢ Business Intelligence Platform</div>\n            <div>Report ID: ${reportId} â€¢ Generated: ${formatDate(timestamp)} â€¢ Timezone: ${CONFIG.TIMEZONE}</div>\n            <div>Data refreshed in real-time â€¢ Professional Analytics</div>\n        </div>\n    </div>\n</body>\n</html>`;\n}\n\n// ============= MAIN EXECUTION =============\ntry {\n    console.log(\"=== STARTING DATA PROCESSING ===\");\n    \n    // Get the input data - handles multiple formats\n    let rawInput = null;\n    \n    // Try to get input from common sources\n    if (typeof items !== 'undefined') {\n        rawInput = items;\n    } else if (typeof input !== 'undefined') {\n        rawInput = input;\n    } else if (typeof data !== 'undefined') {\n        rawInput = data;\n    } else {\n        console.log(\"No input found, using sample data\");\n        rawInput = [];\n    }\n    \n    console.log(\"Raw input type:\", typeof rawInput);\n    \n    // Get orders data in correct format\n    const orders = getOrdersData(rawInput);\n    console.log(\"Orders array length:\", orders.length);\n    \n    // If no orders, use sample data\n    if (orders.length === 0) {\n        console.log(\"Using sample data\");\n        orders.push(\n            {\n                \"order_id\": \"ORD1001\",\n                \"customer_id\": \"CUST001\",\n                \"revenue\": 124500,\n                \"profit\": 24900,\n                \"status\": \"Delivered\",\n                \"city\": \"Mumbai\",\n                \"payment_method\": \"UPI\",\n                \"product_name\": \"iPhone 15 Pro\",\n                \"product_category\": \"Electronics\",\n                \"quantity\": 1,\n                \"order_date\": \"2025-12-15\"\n            },\n            {\n                \"order_id\": \"ORD1002\",\n                \"customer_id\": \"CUST002\",\n                \"revenue\": 87600,\n                \"profit\": 17520,\n                \"status\": \"Delivered\",\n                \"city\": \"Delhi\",\n                \"payment_method\": \"Card\",\n                \"product_name\": \"Samsung TV\",\n                \"product_category\": \"Electronics\",\n                \"quantity\": 1,\n                \"order_date\": \"2025-12-16\"\n            }\n        );\n    }\n    \n    // Process the data\n    const processedData = processData(orders);\n    console.log(\"Data processing completed\");\n    \n    // Generate HTML dashboard\n    const htmlDashboard = generateDashboardHTML(processedData);\n    console.log(\"HTML dashboard generated\");\n    \n    // Return in format compatible with {{ $json.html }}\n    const result = {\n        json: {\n            html: htmlDashboard,\n            data: processedData,\n            metadata: {\n                status: \"success\",\n                generated_at: new Date().toISOString(),\n                records_processed: orders.length,\n                timezone: CONFIG.TIMEZONE,\n                message: \"Dashboard generated successfully\"\n            }\n        }\n    };\n    \n    console.log(\"=== PROCESSING COMPLETED SUCCESSFULLY ===\");\n    console.log(\"Total Revenue:\", formatCurrency(processedData.metrics.total_revenue));\n    console.log(\"Total Orders:\", processedData.metrics.total_orders);\n    \n    // Return the result - MUST be in array format for some systems\n    return [result];\n    \n} catch (error) {\n    console.error(\"=== PROCESSING ERROR ===\");\n    console.error(\"Error:\", error.message);\n    console.error(\"Stack:\", error.stack);\n    \n    const errorHtml = `\n    <!DOCTYPE html>\n    <html>\n    <head>\n        <style>\n            body { font-family: sans-serif; padding: 40px; background: #f8fafc; }\n            .error-container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }\n            h1 { color: #c62828; margin-bottom: 20px; }\n            .error-details { background: #ffebee; padding: 15px; border-radius: 5px; margin-top: 20px; font-family: monospace; }\n        </style>\n    </head>\n    <body>\n        <div class=\"error-container\">\n            <h1>Error Generating Dashboard</h1>\n            <p>There was an error processing your data. Please check the details below:</p>\n            <div class=\"error-details\">\n                <strong>Error:</strong> ${error.message}<br>\n                <strong>Type:</strong> ${error.name || 'Unknown'}<br>\n                <strong>Time:</strong> ${new Date().toISOString()}\n            </div>\n            <p style=\"margin-top: 20px; color: #666;\">\n                Please ensure your data is in the correct format: an array of order objects with required fields.\n            </p>\n        </div>\n    </body>\n    </html>`;\n    \n    const errorResult = {\n        json: {\n            html: errorHtml,\n            error: true,\n            message: error.message,\n            timestamp: new Date().toISOString()\n        }\n    };\n    \n    return [errorResult];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1888,
        160
      ],
      "id": "da5c7637-0afa-49f4-9e9c-3b25c4d84f54",
      "name": "Pro UI"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.html }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.5,
      "position": [
        -1344,
        -96
      ],
      "id": "afdb027b-fc52-4e91-9519-1e8b5ae6e629",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.html }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.5,
      "position": [
        -1360,
        144
      ],
      "id": "10a75466-2669-4f71-84ec-de3bb84112ca",
      "name": "Respond to Webhook1"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "flowlytics analysis",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -2880,
        48
      ],
      "id": "aefe4771-a892-42fa-a45e-0dab71de51bc",
      "name": "Webhook",
      "webhookId": "bcd71d93-1b3e-40c3-b6bc-c04ad88540c2"
    }
  ],
  "pinData": {
    "Webhook": [
      {
        "json": {
          "order_id": "ORD1001",
          "customer_id": "CUST001",
          "revenue": 124500,
          "profit": 24900,
          "status": "Delivered",
          "city": "Mumbai",
          "payment_method": "UPI",
          "product_name": "iPhone 15 Pro",
          "product_category": "Electronics",
          "quantity": 1,
          "order_date": "2025-12-15"
        }
      },
      {
        "json": {
          "order_id": "ORD1002",
          "customer_id": "CUST002",
          "revenue": 87600,
          "profit": 17520,
          "status": "Delivered",
          "city": "Delhi",
          "payment_method": "Card",
          "product_name": "Samsung 4K TV",
          "product_category": "Electronics",
          "quantity": 1,
          "order_date": "2025-12-16"
        }
      },
      {
        "json": {
          "order_id": "ORD1003",
          "customer_id": "CUST003",
          "revenue": 215000,
          "profit": 43000,
          "status": "Delivered",
          "city": "Bangalore",
          "payment_method": "Net Banking",
          "product_name": "MacBook Air M3",
          "product_category": "Electronics",
          "quantity": 1,
          "order_date": "2025-12-10"
        }
      },
      {
        "json": {
          "order_id": "ORD1004",
          "customer_id": "CUST004",
          "revenue": 73400,
          "profit": 14680,
          "status": "Cancelled",
          "city": "Chennai",
          "payment_method": "COD",
          "product_name": "Leather Jacket",
          "product_category": "Fashion",
          "quantity": 2,
          "order_date": "2025-12-12"
        }
      },
      {
        "json": {
          "order_id": "ORD1005",
          "customer_id": "CUST005",
          "revenue": 182300,
          "profit": 36460,
          "status": "Delivered",
          "city": "Hyderabad",
          "payment_method": "UPI",
          "product_name": "Sofa Set 3+2",
          "product_category": "Home",
          "quantity": 1,
          "order_date": "2025-12-18"
        }
      },
      {
        "json": {
          "order_id": "ORD1006",
          "customer_id": "CUST001",
          "revenue": 94200,
          "profit": 18840,
          "status": "Delivered",
          "city": "Mumbai",
          "payment_method": "Card",
          "product_name": "AirPods Pro",
          "product_category": "Electronics",
          "quantity": 1,
          "order_date": "2025-12-05"
        }
      },
      {
        "json": {
          "order_id": "ORD1007",
          "customer_id": "CUST006",
          "revenue": 318400,
          "profit": 63680,
          "status": "Delivered",
          "city": "Pune",
          "payment_method": "Net Banking",
          "product_name": "Gaming Laptop RTX 4070",
          "product_category": "Electronics",
          "quantity": 1,
          "order_date": "2025-12-14"
        }
      },
      {
        "json": {
          "order_id": "ORD1008",
          "customer_id": "CUST007",
          "revenue": 65800,
          "profit": 13160,
          "status": "Delivered",
          "city": "Kolkata",
          "payment_method": "COD",
          "product_name": "Winter Boots",
          "product_category": "Fashion",
          "quantity": 1,
          "order_date": "2025-12-19"
        }
      },
      {
        "json": {
          "order_id": "ORD1009",
          "customer_id": "CUST008",
          "revenue": 279500,
          "profit": 55900,
          "status": "Delivered",
          "city": "Ahmedabad",
          "payment_method": "UPI",
          "product_name": "Queen Size Bed",
          "product_category": "Home",
          "quantity": 1,
          "order_date": "2025-12-11"
        }
      },
      {
        "json": {
          "order_id": "ORD1010",
          "customer_id": "CUST002",
          "revenue": 115200,
          "profit": 23040,
          "status": "Delivered",
          "city": "Delhi",
          "payment_method": "Card",
          "product_name": "iPad Pro",
          "product_category": "Electronics",
          "quantity": 1,
          "order_date": "2025-12-08"
        }
      },
      {
        "json": {
          "order_id": "ORD1011",
          "customer_id": "CUST009",
          "revenue": 46200,
          "profit": 9240,
          "status": "Cancelled",
          "city": "Jaipur",
          "payment_method": "COD",
          "product_name": "Samsung 4K TV",
          "product_category": "Electronics",
          "quantity": 1,
          "order_date": "2025-12-17"
        }
      },
      {
        "json": {
          "order_id": "ORD1012",
          "customer_id": "CUST010",
          "revenue": 193400,
          "profit": 38680,
          "status": "Delivered",
          "city": "Lucknow",
          "payment_method": "UPI",
          "product_name": "MacBook Air M3",
          "product_category": "Electronics",
          "quantity": 1,
          "order_date": "2025-12-13"
        }
      },
      {
        "json": {
          "order_id": "ORD1013",
          "customer_id": "CUST003",
          "revenue": 157800,
          "profit": 31560,
          "status": "Delivered",
          "city": "Bangalore",
          "payment_method": "Net Banking",
          "product_name": "Designer Handbag",
          "product_category": "Fashion",
          "quantity": 1,
          "order_date": "2025-12-20"
        }
      },
      {
        "json": {
          "order_id": "ORD1014",
          "customer_id": "CUST011",
          "revenue": 83500,
          "profit": 16700,
          "status": "Delivered",
          "city": "Surat",
          "payment_method": "Card",
          "product_name": "Dining Table Set",
          "product_category": "Home",
          "quantity": 1,
          "order_date": "2025-12-06"
        }
      },
      {
        "json": {
          "order_id": "ORD1015",
          "customer_id": "CUST012",
          "revenue": 291200,
          "profit": 58240,
          "status": "Delivered",
          "city": "Nagpur",
          "payment_method": "UPI",
          "product_name": "AirPods Pro",
          "product_category": "Electronics",
          "quantity": 2,
          "order_date": "2025-12-15"
        }
      },
      {
        "json": {
          "order_id": "ORD1016",
          "customer_id": "CUST013",
          "revenue": 138700,
          "profit": 27740,
          "status": "Delivered",
          "city": "Indore",
          "payment_method": "COD",
          "product_name": "Gaming Laptop RTX 4070",
          "product_category": "Electronics",
          "quantity": 1,
          "order_date": "2025-12-09"
        }
      },
      {
        "json": {
          "order_id": "ORD1017",
          "customer_id": "CUST001",
          "revenue": 208900,
          "profit": 41780,
          "status": "Delivered",
          "city": "Mumbai",
          "payment_method": "UPI",
          "product_name": "Winter Coat",
          "product_category": "Fashion",
          "quantity": 1,
          "order_date": "2025-12-03"
        }
      },
      {
        "json": {
          "order_id": "ORD1018",
          "customer_id": "CUST014",
          "revenue": 69500,
          "profit": 13900,
          "status": "Cancelled",
          "city": "Bhopal",
          "payment_method": "Card",
          "product_name": "Queen Size Bed",
          "product_category": "Home",
          "quantity": 1,
          "order_date": "2025-12-18"
        }
      },
      {
        "json": {
          "order_id": "ORD1019",
          "customer_id": "CUST015",
          "revenue": 327800,
          "profit": 65560,
          "status": "Delivered",
          "city": "Patna",
          "payment_method": "Net Banking",
          "product_name": "iPhone 15 Pro",
          "product_category": "Electronics",
          "quantity": 1,
          "order_date": "2025-12-12"
        }
      },
      {
        "json": {
          "order_id": "ORD1020",
          "customer_id": "CUST005",
          "revenue": 178400,
          "profit": 35680,
          "status": "Delivered",
          "city": "Hyderabad",
          "payment_method": "UPI",
          "product_name": "Smart Watch Series 8",
          "product_category": "Electronics",
          "quantity": 1,
          "order_date": "2025-12-19"
        }
      }
    ]
  },
  "connections": {
    "Calculate matrix": {
      "main": [
        [
          {
            "node": "Function node",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Calculate matrix",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Function node": {
      "main": [
        [
          {
            "node": "Basic UI",
            "type": "main",
            "index": 0
          },
          {
            "node": "Pro UI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Basic UI": {
      "main": [
        [
          {
            "node": "HTML2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pro UI": {
      "main": [
        [
          {
            "node": "HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML": {
      "main": [
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML2": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "bcaa247b-b31e-477b-9010-882efc13fd82",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "80d62e378eab4fbd8842e77840b48c0244f5a0dffad50d197413e67e35b0a5a9"
  },
  "id": "8A4gjuWwqIuyQqzn",
  "tags": []
}